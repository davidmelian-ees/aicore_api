================================================================================
                        ERRORES COMUNES EN PLIEGOS SAP
                    Sistema de Validaci√≥n Pre-Informe
================================================================================

OBJETIVO:
Detectar autom√°ticamente errores frecuentes ANTES de generar el informe completo
de validaci√≥n estructural. Estos errores son reportados directamente por el
generador de pliegos y requieren validaci√≥n autom√°tica prioritaria.

================================================================================
                            ERRORES IDENTIFICADOS
================================================================================

1. CANTIDAD DE LOTES:
   ‚ùå PROBLEMA: Inconsistencia entre el n√∫mero de lotes declarados y los realmente incluidos
   
   VALIDACIONES:
   - Contar menciones de "LOTE" en el documento
   - Verificar numeraci√≥n secuencial (Lote 1, Lote 2, etc.)
   - Detectar lotes duplicados o saltos en numeraci√≥n
   - Validar que cada lote tenga presupuesto asignado
   
   PATRONES A DETECTAR:
   - "LOTE \d+" (Lote 1, Lote 2, etc.)
   - "Lot \d+" (variante catalana)
   - Tablas con columnas de lotes
   - Presupuestos por lote

2. TAGS SAP SIN RELLENAR:
   ‚ùå PROBLEMA: Tags de variables SAP que no fueron reemplazados con datos reales
   
   VALIDACIONES:
   - Buscar patrones {{VARIABLE}}
   - Detectar [CAMPO_PENDIENTE]
   - Encontrar <<DATO_FALTANTE>>
   - Identificar {VALOR_VACIO}
   - Localizar @VARIABLE_SAP@
   
   PATRONES CR√çTICOS:
   - {{.*?}} (cualquier contenido entre llaves dobles)
   - \[.*?\] (contenido entre corchetes)
   - <<.*?>> (contenido entre dobles menor/mayor)
   - @.*?@ (contenido entre arrobas)
   - {.*?} (contenido entre llaves simples)

3. CAMPOS S√ç/NO DUPLICADOS:
   ‚ùå PROBLEMA: Marcar tanto S√ç como NO en campos excluyentes
   
   VALIDACIONES:
   - Detectar "‚òë S√ç" y "‚òë NO" en la misma secci√≥n
   - Buscar "X S√ç" y "X NO" simult√°neos
   - Identificar "[X] S√ç" y "[X] NO" marcados
   - Validar checkboxes duplicados en formularios
   
   PATRONES A DETECTAR:
   - (\[X\]|\‚òë|X)\s*(S√ç|SI).*?(\[X\]|\‚òë|X)\s*(NO)
   - Campos con ambas opciones marcadas
   - Secciones con respuestas contradictorias

4. FORMATO DE FECHA INCORRECTO:
   ‚ùå PROBLEMA: Fechas en formato incorrecto o inconsistente
   
   FORMATO CORRECTO CATAL√ÅN: DD/MM/AAAA
   
   VALIDACIONES:
   - Detectar fechas en formato americano (MM/DD/AAAA)
   - Identificar fechas con guiones (DD-MM-AAAA)
   - Validar fechas con formato ISO (AAAA-MM-DD)
   - Verificar fechas en ingl√©s (Month DD, YYYY)
   
   PATRONES INCORRECTOS:
   - \d{4}-\d{2}-\d{2} (formato ISO)
   - \d{1,2}-\d{1,2}-\d{4} (con guiones)
   - [A-Za-z]+ \d{1,2}, \d{4} (formato ingl√©s)
   - Fechas con meses en ingl√©s

5. FORMATO DE IMPORTES INCORRECTO:
   ‚ùå PROBLEMA: Importes sin formato euro correcto o con separadores incorrectos
   
   FORMATO CORRECTO: 123.456,78 ‚Ç¨ (punto miles, coma decimales)
   
   VALIDACIONES:
   - Detectar formato americano: 123,456.78 (coma miles, punto decimales)
   - Identificar ‚Ç¨ al inicio en lugar del final
   - Validar separadores incorrectos
   - Verificar espacios entre n√∫mero y s√≠mbolo
   
   PATRONES INCORRECTOS:
   - ‚Ç¨\s*\d+ (euro al inicio)
   - \d+,\d{3}\.\d{2} (formato americano)
   - \d+‚Ç¨ (sin espacio antes del euro)
   - EUR en lugar de ‚Ç¨

6. IDIOMA INCORRECTO (NO CATAL√ÅN):
   ‚ùå PROBLEMA: Texto en castellano o otros idiomas en lugar de catal√°n
   
   VALIDACIONES:
   - Detectar palabras en castellano comunes
   - Identificar t√©rminos t√©cnicos no traducidos
   - Validar nombres de meses en catal√°n
   - Verificar terminolog√≠a legal catalana
   
   PALABRAS CASTELLANAS COMUNES A DETECTAR:
   - "presupuesto" ‚Üí debe ser "pressupost"
   - "contrato" ‚Üí debe ser "contracte"
   - "licitaci√≥n" ‚Üí debe ser "licitaci√≥"
   - "adjudicaci√≥n" ‚Üí debe ser "adjudicaci√≥"
   - "enero, febrero..." ‚Üí debe ser "gener, febrer..."
   - "obras" ‚Üí debe ser "obres"
   - "proyecto" ‚Üí debe ser "projecte"

7. NUMERACI√ìN SECUENCIAL INCORRECTA:
   ‚ùå PROBLEMA: Saltos en la numeraci√≥n de puntos del pliego
   
   VALIDACIONES:
   - Detectar saltos en numeraci√≥n principal (ej: 1. 2. 4. ‚Üê falta el 3.)
   - Verificar subnumeraci√≥n correcta (ej: 3.1, 3.2, 3.3)
   - Validar jerarqu√≠a de niveles (ej: 3.1.1, 3.1.2)
   - Alertar sobre posibles puntos faltantes
   
   EJEMPLOS CORRECTOS:
   ‚úÖ 1.
   ‚úÖ 2.
   ‚úÖ 3.
   ‚úÖ 3.1
   ‚úÖ 3.1.1
   ‚úÖ 3.1.2
   ‚úÖ 3.2
   ‚úÖ 4.
   
   EJEMPLOS INCORRECTOS:
   ‚ùå 1.
   ‚ùå 4. ‚Üê FALTA 2. y 3.
   
   ‚ùå 3.
   ‚ùå 3.1
   ‚ùå 3.3 ‚Üê FALTA 3.2
   
   SEVERIDAD:
   - Salto de 1 punto: ‚ö†Ô∏è ADVERTENCIA (puede ser intencional)
   - Salto de 2+ puntos: üî¥ ERROR CR√çTICO (probablemente faltan secciones)

8. TABLAS APLICA/NO APLICA INCOMPLETAS:
   ‚ùå PROBLEMA: Campos vac√≠os en tablas que requieren "APLICA" o "NO APLICA"
   
   ‚ö†Ô∏è INSTRUCCI√ìN CR√çTICA PARA LA IA:
   DEBES CONTAR LAS COLUMNAS "APLICA" Y "NO APLICA" EN CADA FILA.
   CADA FILA DEBE TENER EXACTAMENTE 2 VALORES (UNO EN CADA COLUMNA).
   SI UNA FILA TIENE SOLO 1 VALOR O M√ÅS DE 2, ES UN ERROR CR√çTICO.
   
   PROCESO DE VALIDACI√ìN PASO A PASO:
   
   PASO 1: Identificar tablas con encabezados "APLICA" y "NO APLICA"
   PASO 2: Para CADA fila de la tabla:
           - Contar cu√°ntos valores "APLICA" hay
           - Contar cu√°ntos valores "NO APLICA" hay
           - Contar cu√°ntos campos vac√≠os hay
   PASO 3: Validar que cada fila tenga EXACTAMENTE:
           - 1 valor en columna APLICA (puede ser "APLICA" o vac√≠o)
           - 1 valor en columna NO APLICA (puede ser "NO APLICA" o vac√≠o)
           - TOTAL: 2 columnas, al menos 1 debe tener valor
   PASO 4: Reportar filas con:
           - Ambas columnas vac√≠as (ERROR CR√çTICO)
           - Solo 1 columna cuando deber√≠a haber 2 (ERROR CR√çTICO)
           - Ambas columnas con valor (ERROR CR√çTICO - excluyentes)
   
   EJEMPLO REAL DE ERROR (DEBES DETECTAR ESTO):
   
   Texto del pliego:
   "1.03 Comprom√≠s sobre subcontractaci√≥    APLICA    APLICA
    1.04 Comprom√≠s sobre emissions CO2eq    APLICA
    1.05 Declaracions Ambientals            APLICA    APLICA
    1.06 Utilitzaci√≥ de fusta certificada   APLICA"
   
   AN√ÅLISIS QUE DEBES HACER:
   
   Fila 1.03: "APLICA" + "APLICA" = 2 valores ‚úÖ CORRECTO
   Fila 1.04: "APLICA" + [VAC√çO] = 1 valor ‚ùå ERROR (falta columna NO APLICA)
   Fila 1.05: "APLICA" + "APLICA" = 2 valores ‚úÖ CORRECTO
   Fila 1.06: "APLICA" + [VAC√çO] = 1 valor ‚ùå ERROR (falta columna NO APLICA)
   
   REPORTE QUE DEBES GENERAR:
   "üî¥ ERROR CR√çTICO: Tabla APLICA/NO APLICA incompleta
    
    Las siguientes filas tienen campos vac√≠os:
    
    ‚Ä¢ Fila 1.04 (Comprom√≠s sobre emissions CO2eq):
      - Columna APLICA: APLICA ‚úì
      - Columna NO APLICA: [VAC√çO] ‚ùå
      Debe tener valor en ambas columnas o marcar solo una
    
    ‚Ä¢ Fila 1.06 (Utilitzaci√≥ de fusta certificada):
      - Columna APLICA: APLICA ‚úì
      - Columna NO APLICA: [VAC√çO] ‚ùå
      Debe tener valor en ambas columnas o marcar solo una"
   
   PATRONES A DETECTAR:
   - Tablas con encabezados "APLICA" o "NO APLICA"
   - Filas con solo 1 valor cuando la tabla tiene 2 columnas
   - Celdas vac√≠as en columnas de aplicabilidad
   - Valores incorrectos (ej: "S√ç", "NO", "N/A" en lugar de "APLICA"/"NO APLICA")
   
   EJEMPLOS CORRECTOS:
   ‚úÖ | Criterio | APLICA | NO APLICA |
      | 1.01     | APLICA | APLICA    | ‚Üê Ambas columnas con valor
      | 1.02     | APLICA | APLICA    | ‚Üê Ambas columnas con valor
   
   ‚úÖ | Criterio | APLICA | NO APLICA |
      | 1.01     |   X    |           | ‚Üê Solo APLICA marcado
      | 1.02     |        |     X     | ‚Üê Solo NO APLICA marcado
   
   EJEMPLOS INCORRECTOS:
   ‚ùå | Criterio | APLICA | NO APLICA |
      | 1.01     | APLICA | APLICA    | ‚Üê OK
      | 1.02     | APLICA |           | ‚Üê ERROR: Falta valor en NO APLICA
      | 1.03     | APLICA | APLICA    | ‚Üê OK
      | 1.04     | APLICA |           | ‚Üê ERROR: Falta valor en NO APLICA
   
   ‚ùå | Criterio | APLICA | NO APLICA |
      | 1.01     |        |           | ‚Üê ERROR: Ambas vac√≠as
      | 1.02     |   X    |     X     | ‚Üê ERROR: Ambas marcadas (excluyentes)
   
   VALIDACIONES ESPEC√çFICAS:
   - Contar columnas en el encabezado de la tabla
   - Contar valores en cada fila
   - Comparar: ¬øn√∫mero de valores en fila == n√∫mero de columnas?
   - Si NO coincide: ERROR CR√çTICO
   - Identificar exactamente qu√© filas tienen el problema
   - Reportar n√∫mero de fila y nombre del criterio afectado
   
   SEVERIDAD:
   - Campo vac√≠o en tabla de 2 columnas: üî¥ ERROR CR√çTICO
   - Fila con solo 1 valor cuando tabla tiene 2 columnas: üî¥ ERROR CR√çTICO
   - Ambas columnas vac√≠as: üî¥ ERROR CR√çTICO
   - Ambas columnas marcadas (excluyentes): üî¥ ERROR CR√çTICO
   - Valor incorrecto (S√ç/NO en lugar de APLICA): üü° ADVERTENCIA

9. SECCIONES OBLIGATORIAS FALTANTES:
   ‚ùå PROBLEMA: Faltan apartados obligatorios seg√∫n el tipo de pliego
   
   SECCIONES OBLIGATORIAS EN TODOS LOS PLIEGOS:
   - OBJETO DEL CONTRATO
   - PRESUPUESTO
   - PLAZO DE EJECUCI√ìN
   - CONDICIONES T√âCNICAS
   - CRITERIOS DE ADJUDICACI√ìN
   - GARANT√çAS
   - PENALIDADES
   - MODIFICACI√ìN DEL CONTRATO
   - SUBCONTRATACI√ìN
   - REVISI√ìN DE PRECIOS
   
   VALIDACIONES:
   - Verificar presencia de todas las secciones obligatorias
   - Detectar secciones con contenido vac√≠o
   - Validar que las secciones est√©n en orden l√≥gico
   - Identificar secciones duplicadas
   
   SEVERIDAD:
   - Secci√≥n obligatoria faltante: üî¥ ERROR CR√çTICO
   - Secci√≥n vac√≠a: üü° ADVERTENCIA
   - Secci√≥n duplicada: üü° ADVERTENCIA
   - Orden incorrecto: üü° ADVERTENCIA

10. INCOHERENCIA NUM√âRICA EN PRESUPUESTOS Y LOTES:
    ‚ùå PROBLEMA: Las sumas de lotes no coinciden con el presupuesto total declarado
    
    ‚ö†Ô∏è INSTRUCCI√ìN CR√çTICA PARA LA IA:
    DEBES REALIZAR C√ÅLCULOS MATEM√ÅTICOS EXPL√çCITOS. NO ASUMAS QUE LOS N√öMEROS SON CORRECTOS.
    EXTRAE CADA N√öMERO, S√öMALOS MANUALMENTE Y COMPARA CON EL TOTAL DECLARADO.
    
    PROCESO PASO A PASO OBLIGATORIO:
    
    PASO 1: Buscar la l√≠nea "PRESSUPOST DE LICITACI√ì" o "PRESUPUESTO DE LICITACI√ìN"
    PASO 2: Extraer el importe total con IVA incluido (primer n√∫mero)
    PASO 3: Extraer el importe total sin IVA (segundo n√∫mero despu√©s de la coma)
    PASO 4: Buscar la tabla de lotes inmediatamente despu√©s
    PASO 5: Extraer TODOS los importes de la columna "Pressupost euros (IVA incl√≤s)"
    PASO 6: SUMAR manualmente todos los importes de lotes (con IVA)
    PASO 7: COMPARAR: suma_lotes vs presupuesto_total_declarado
    PASO 8: CALCULAR diferencia absoluta: |presupuesto_declarado - suma_lotes|
    PASO 9: REPORTAR si diferencia > 0.50‚Ç¨
    
    EJEMPLO REAL DE ERROR (DEBES DETECTAR ESTO):
    
    Texto del pliego:
    "PRESSUPOST DE LICITACI√ì: 243.936,00 euros (IVA incl√≤s), 201.600,00 euros (IVA no incl√≤s)
     
     Lot | Descripci√≥                      | Pressupost (IVA incl√≤s) | TOTAL (IVA no incl√≤s)
     1   | Carretera de Rub√≠ al Papiol     | 241.840,28             | 200.694,44
     2   | Carretera del Papiol a Mira-Sol | 1.942,72               | 1.605,56"
    
    AN√ÅLISIS QUE DEBES HACER:
    
    1. Presupuesto declarado (IVA incl√≤s): 243.936,00 euros
    2. Importes de lotes extra√≠dos:
       - Lot 1: 241.840,28 euros
       - Lot 2: 1.942,72 euros
    3. SUMA MANUAL: 241.840,28 + 1.942,72 = 243.783,00 euros
    4. COMPARACI√ìN: 243.936,00 (declarado) vs 243.783,00 (suma real)
    5. DIFERENCIA: 243.936,00 - 243.783,00 = 153,00 euros
    6. CONCLUSI√ìN: ERROR CR√çTICO (diferencia > 100‚Ç¨)
    
    REPORTE QUE DEBES GENERAR:
    "üî¥ ERROR CR√çTICO: Incoherencia num√©rica en presupuesto de licitaci√≥n
     
     Presupuesto declarado: 243.936,00‚Ç¨ (IVA incl√≤s)
     Suma de lotes: 243.783,00‚Ç¨
     Diferencia: 153,00‚Ç¨
     
     Detalle de lotes:
     - Lot 1: 241.840,28‚Ç¨
     - Lot 2: 1.942,72‚Ç¨
     - SUMA: 243.783,00‚Ç¨
     
     El presupuesto declarado NO coincide con la suma de lotes.
     Posible error en el importe del Lot 2 (deber√≠a ser 2.095,72‚Ç¨ en lugar de 1.942,72‚Ç¨)"
    
    EJEMPLO CORRECTO (para comparaci√≥n):
    ‚úÖ PRESSUPOST DE LICITACI√ì: 243.936,00 euros (IVA incl√≤s)
       Lot 1: 241.840,28 euros
       Lot 2: 2.095,72 euros
       SUMA: 241.840,28 + 2.095,72 = 243.936,00 euros ‚Üê COINCIDE EXACTAMENTE
    
    PATRONES A DETECTAR:
    - "PRESSUPOST DE LICITACI√ì:" o "PRESUPUESTO DE LICITACI√ìN:"
    - Tablas con columnas "Lot", "Lote", "Pressupost", "Presupuesto"
    - Importes en formato: 123.456,78 euros
    - Menciones "(IVA incl√≤s)" o "(IVA no incl√≤s)"
    
    VALIDACIONES ESPEC√çFICAS:
    - Extraer presupuesto total con IVA incluido
    - Extraer presupuesto total sin IVA
    - Sumar lotes con IVA incluido
    - Sumar lotes sin IVA
    - Comparar ambas sumas (con IVA y sin IVA)
    - Validar que diferencia sea < 0.50‚Ç¨ (tolerancia por redondeos)
    
    C√ÅLCULOS A REALIZAR:
    1. Identificar secci√≥n "DADES ECON√íMIQUES" o "DATOS ECON√ìMICOS"
    2. Extraer l√≠nea con "PRESSUPOST DE LICITACI√ì" o similar
    3. Extraer dos importes: (IVA incl√≤s) y (IVA no incl√≤s)
    4. Buscar tabla de lotes posterior
    5. Extraer todos los importes de la columna de presupuesto
    6. Sumar importes de lotes
    7. Comparar: |suma_lotes - presupuesto_total| < 0.50‚Ç¨
    
    SEVERIDAD:
    - Diferencia > 100‚Ç¨: üî¥ ERROR CR√çTICO (error de c√°lculo grave)
    - Diferencia 1‚Ç¨ - 100‚Ç¨: üü° ADVERTENCIA (posible error de redondeo)
    - Diferencia < 1‚Ç¨: ‚úÖ CORRECTO (tolerancia aceptable)
    - Falta tabla de lotes cuando se declaran lotes: üî¥ ERROR CR√çTICO
    - N√∫mero de lotes en tabla ‚â† n√∫mero declarado: üî¥ ERROR CR√çTICO

11. COMENTARIOS DE DESARROLLADORES Y TAGS SAP SIN REEMPLAZAR:
    PROBLEMA: El pliego contiene comentarios de desarrollo o tags SAP sin reemplazar

12. FORMATO DE IMPORTES INCONSISTENTE:
    ‚ùå PROBLEMA: Los importes monetarios aparecen con formatos diferentes a lo largo del documento
    
    ‚ö†Ô∏è INSTRUCCI√ìN CR√çTICA PARA LA IA:
    TODOS LOS IMPORTES DEBEN SEGUIR EL MISMO FORMATO EST√ÅNDAR.
    DEBES VERIFICAR CADA IMPORTE Y REPORTAR INCONSISTENCIAS.
    
    FORMATO EST√ÅNDAR CORRECTO:
    - Separador de miles: Punto (.)
    - Separador decimal: Coma (,)
    - Decimales: Siempre 2 d√≠gitos (,00)
    - S√≠mbolo: ‚Ç¨ con espacio antes
    - Ejemplo: 2.450.000,00 ‚Ç¨
    
    PROCESO DE VALIDACI√ìN PASO A PASO:
    
    PASO 1: Buscar TODOS los importes monetarios en el documento
    PASO 2: Para CADA importe encontrado, verificar:
            - ¬øTiene separador de miles (punto)?
            - ¬øTiene separador decimal (coma)?
            - ¬øTiene exactamente 2 decimales?
            - ¬øTiene s√≠mbolo ‚Ç¨ con espacio antes?
    PASO 3: Identificar importes con formato diferente
    PASO 4: Listar TODOS los importes incorrectos con su ubicaci√≥n
    
    EJEMPLOS DE FORMATOS INCORRECTOS:
    
    ‚ùå 2450000 (sin separadores ni s√≠mbolo)
    ‚ùå 2.450.000 (sin decimales ni s√≠mbolo)
    ‚ùå 2.450.000 EUR (EUR en lugar de ‚Ç¨)
    ‚ùå 2.450.000,00‚Ç¨ (sin espacio antes de ‚Ç¨)
    ‚ùå ‚Ç¨2.450.000,00 (‚Ç¨ al inicio)
    ‚ùå 2,450,000.00 ‚Ç¨ (formato americano)
    ‚ùå 2.450.000.00 ‚Ç¨ (punto como decimal)
    
    EJEMPLOS CORRECTOS:
    ‚úÖ 2.450.000,00 ‚Ç¨
    ‚úÖ 150,50 ‚Ç¨
    ‚úÖ 1.234.567,89 ‚Ç¨
    ‚úÖ 0,00 ‚Ç¨
    
    REPORTE QUE DEBES GENERAR:
    "üü° ADVERTENCIA: Formato de importes inconsistente
     
     Los siguientes importes no siguen el formato est√°ndar (X.XXX.XXX,XX ‚Ç¨):
     
     ‚Ä¢ Secci√≥n 'PRESUPUESTO': 2.450.000 EUR
       Formato correcto: 2.450.000,00 ‚Ç¨
     
     ‚Ä¢ Tabla de lotes, Lote 2: 150.50‚Ç¨
       Formato correcto: 150,50 ‚Ç¨
     
     ‚Ä¢ P√°gina 5, p√°rrafo 3: ‚Ç¨1.234.567,89
       Formato correcto: 1.234.567,89 ‚Ç¨"
    
    PATRONES A DETECTAR:
    - Importes sin decimales: \d{1,3}(?:\.\d{3})* (sin ,\d{2})
    - ‚Ç¨ al inicio: ‚Ç¨\s*\d+
    - Sin espacio antes de ‚Ç¨: \d+‚Ç¨
    - EUR en lugar de ‚Ç¨: \d+.*?EUR
    - Formato americano: \d{1,3}(?:,\d{3})*\.\d{2}
    - Punto como decimal: \d+\.\d{2}\s*‚Ç¨
    
    SEVERIDAD:
    - Formato inconsistente: üü° ADVERTENCIA
    - M√°s de 5 importes incorrectos: üî¥ ERROR CR√çTICO
    
    INSTRUCCION CRITICA PARA LA IA:
    DEBES BUSCAR ACTIVAMENTE CUALQUIER TEXTO QUE PAREZCA SER:
    - Un comentario de un desarrollador
    - Una instruccion tecnica sobre que hacer
    - Una variable SAP sin reemplazar (empieza con Z)
    - Texto resaltado o con formato de borrador
    
    PATRONES A DETECTAR:
    
    1. COMENTARIOS DE DESARROLLADORES:
       - Texto con nombre + dos puntos: "Oriol:", "David:", "Maria:", "Joan:"
       - Instrucciones en catalan: "S'haura de treure", "no treure la taula", "Escollir quina de les 2"
       - Referencias a tablas SAP: "si hi ha valors a la taula ZRM_", "a la taula ZVRM_"
       - Condiciones tecnicas: "Si ZVRM_QDC_CLO_LIC-ZZ_NUM_LOT = 000", "En cas que apliqui"
       - Instrucciones sobre columnas: "quan no hi hagi lots, a la columna material"
    
    2. TAGS SAP SIN REEMPLAZAR (Variables que empiezan con Z):
       - ZRM_DM_MAT_CO2
       - ZVRM_QDC_MAT_LIC
       - ZVRM_QDC_CLO_LIC-ZZ_NUM_LOT
       - Cualquier variable: Z[A-Z_]+
    
    3. TEXTO RESALTADO CON INSTRUCCIONES:
       - Texto en amarillo con instrucciones
       - Texto en rojo con comentarios
       - Placeholders o borradores visibles
       - Instrucciones entre parentesis
    
    EJEMPLOS REALES DE ERRORES:
    
    ERROR 1:
    "Oriol: En cas que apliqui el CO2 (si hi ha valors a la taula ZRM_DM_MAT_CO2 o 
    ZVRM_QDC_MAT_LIC -> Escollir quina de les 2) S'haura de treure el text en groc."
    
    REPORTE ESPERADO:
    "ERROR CRITICO: Comentario de desarrollador detectado
     - Linea: 'Oriol: En cas que apliqui el CO2...'
     - Contiene: Nombre desarrollador + instrucciones tecnicas
     - Tags SAP sin reemplazar: ZRM_DM_MAT_CO2, ZVRM_QDC_MAT_LIC"
    
    ERROR 2:
    "Oriol: Si ZVRM_QDC_CLO_LIC-ZZ_NUM_LOT = 000 no treure la taula seguent"
    
    REPORTE ESPERADO:
    "ERROR CRITICO: Comentario de desarrollador detectado
     - Linea: 'Oriol: Si ZVRM_QDC_CLO_LIC-ZZ_NUM_LOT = 000...'
     - Contiene: Condicion tecnica SAP
     - Tag SAP sin reemplazar: ZVRM_QDC_CLO_LIC-ZZ_NUM_LOT"
    
    SEVERIDAD: ERROR CRITICO (bloquea generacion)

================================================================================
                        NIVELES DE CRITICIDAD
================================================================================

üî¥ CR√çTICO (Bloquea generaci√≥n):
- Tags SAP sin rellenar
- Comentarios de desarrolladores en el texto (Oriol:, David:, etc.)
- Tags SAP sin reemplazar (ZRM_, ZVRM_, etc.)
- Campos S√ç/NO duplicados
- Cantidad de lotes incorrecta
- Saltos de 2+ puntos en numeraci√≥n (probablemente faltan secciones)
- Tablas APLICA/NO APLICA con campos vac√≠os
- Tablas APLICA/NO APLICA con ambas opciones marcadas
- Secciones obligatorias faltantes
- Incoherencia num√©rica > 100‚Ç¨ entre presupuesto total y suma de lotes
- Falta tabla de lotes cuando se declaran lotes
- N√∫mero de lotes en tabla diferente al declarado

üü° ADVERTENCIA (Permite continuar):
- Formato de fecha incorrecto
- Formato de importes incorrecto
- Formato de importes inconsistente (Error #12 - Jes√∫s Arenas)
- Palabras en castellano detectadas
- Salto de 1 punto en numeraci√≥n (puede ser intencional)
- Secciones vac√≠as
- Secciones duplicadas
- Orden incorrecto de secciones
- Valores no est√°ndar en tablas APLICA/NO APLICA
- Incoherencia num√©rica 1‚Ç¨-100‚Ç¨ entre presupuesto y lotes (posible redondeo)

================================================================================
                        INTEGRACI√ìN CON VALIDACI√ìN
================================================================================

FLUJO PROPUESTO:
1. Recibir documento para validaci√≥n
2. EJECUTAR validaci√≥n de errores comunes (PRE-VALIDACI√ìN)
3. Si hay errores cr√≠ticos ‚Üí Devolver lista de errores inmediatamente
4. Si solo hay advertencias ‚Üí Continuar con validaci√≥n estructural completa
5. Incluir errores comunes en el informe final

CONTEXTO RAG SUGERIDO:
- Subir este archivo a contexto: "ERRORES_COMUNES_PLIEGOS"
- Usar para entrenar detecci√≥n autom√°tica
- Actualizar patrones seg√∫n nuevos errores reportados

================================================================================
                        PATRONES REGEX ESPEC√çFICOS
================================================================================

TAGS SAP SIN RELLENAR:
- /\{\{[^}]*\}\}/g
- /\[[^\]]*\]/g
- /<<[^>]*>>/g
- /@[^@]*@/g

CAMPOS S√ç/NO DUPLICADOS:
- /(\[X\]|\‚òë|X)\s*(S√ç|SI)[\s\S]*?(\[X\]|\‚òë|X)\s*(NO)/gi

FECHAS INCORRECTAS:
- /\d{4}-\d{2}-\d{2}/g (ISO)
- /\d{1,2}-\d{1,2}-\d{4}/g (guiones)

IMPORTES INCORRECTOS:
- /‚Ç¨\s*\d+/g (euro al inicio)
- /\d+,\d{3}\.\d{2}/g (formato americano)

LOTES:
- /LOTE?\s*(\d+)/gi
- /LOT\s*(\d+)/gi

PALABRAS CASTELLANAS:
- /\b(presupuesto|contrato|licitaci√≥n|adjudicaci√≥n|obras|proyecto)\b/gi

COMENTARIOS DE DESARROLLADORES:
- /^[A-Z][a-z]+:\s+/gm (Oriol:, David:, Maria:)
- /S'haur√† de treure/gi
- /no treure/gi
- /Escollir quina de les/gi
- /si hi ha valors a la taula/gi

TAGS SAP SIN REEMPLAZAR (Variables Z):
- /\bZ[A-Z_]+[A-Z0-9_]*\b/g
- /ZVRM_[A-Z_]+/g
- /ZRM_[A-Z_]+/g

NUMERACI√ìN:
- /^(\d+(?:\.\d+)*)\.\s+/gm (detectar numeraci√≥n: 1., 2.1, 3.1.1, etc.)
- Validar secuencia: extraer n√∫meros y verificar continuidad

TABLAS APLICA/NO APLICA:
- /APLICA|NO APLICA/gi (detectar tablas con estos encabezados)
- /\|\s*\|\s*\|/g (detectar celdas vac√≠as en tablas)
- /APLICA:\s*$/gim (detectar campos APLICA vac√≠os)
- /NO APLICA:\s*$/gim (detectar campos NO APLICA vac√≠os)

SECCIONES OBLIGATORIAS:
- Buscar texto exacto (case-insensitive):
  - "OBJETO DEL CONTRATO" o "OBJECTE DEL CONTRACTE"
  - "PRESUPUESTO" o "PRESSUPOST"
  - "PLAZO DE EJECUCI√ìN" o "TERMINI D'EXECUCI√ì"
  - "CONDICIONES T√âCNICAS" o "CONDICIONS T√àCNIQUES"
  - "CRITERIOS DE ADJUDICACI√ìN" o "CRITERIS D'ADJUDICACI√ì"
  - "GARANT√çAS" o "GARANTIES"
  - "PENALIDADES" o "PENALITATS"
  - "MODIFICACI√ìN DEL CONTRATO" o "MODIFICACI√ì DEL CONTRACTE"
  - "SUBCONTRATACI√ìN" o "SUBCONTRACTACI√ì"
  - "REVISI√ìN DE PRECIOS" o "REVISI√ì DE PREUS"

COHERENCIA NUM√âRICA PRESUPUESTOS:
- /PRESSUPOST DE LICITACI√ì:\s*([\d.,]+)\s*euros\s*\(IVA incl√≤s\)/gi
- /PRESUPUESTO DE LICITACI√ìN:\s*([\d.,]+)\s*euros\s*\(IVA incluido\)/gi
- /Lot\s*\d+.*?([\d.,]+)\s*euros/gi (extraer importes de lotes)
- Convertir formato catal√°n (123.456,78) a n√∫mero para c√°lculos
- Sumar todos los importes de lotes
- Calcular diferencia absoluta: |presupuesto_total - suma_lotes|
- Clasificar seg√∫n diferencia: <1‚Ç¨ OK, 1-100‚Ç¨ WARNING, >100‚Ç¨ ERROR

================================================================================
                            EJEMPLOS DE ERRORES
================================================================================

‚ùå TAG SIN RELLENAR:
"El presupuesto total es de {{IMPORTE_TOTAL}} euros"

‚ùå S√ç/NO DUPLICADO:
"‚òë S√ç, se incluyen lotes
 ‚òë NO, no se incluyen lotes"

‚ùå FECHA INCORRECTA:
"Fecha l√≠mite: 2025-10-22" (debe ser "22/10/2025")

‚ùå IMPORTE INCORRECTO:
"Presupuesto: ‚Ç¨ 123,456.78" (debe ser "123.456,78 ‚Ç¨")

‚ùå LOTES INCONSISTENTES:
"Se divide en 3 lotes" pero solo aparecen "Lote 1" y "Lote 2"

‚ùå IDIOMA INCORRECTO:
"presupuesto de licitaci√≥n" (debe ser "pressupost de licitaci√≥")

‚ùå NUMERACI√ìN CON SALTO:
"1. Introducci√≥n
 2. Objeto del contrato
 5. Presupuesto" ‚Üê FALTA 3. y 4. (ERROR CR√çTICO)

‚ùå TABLA APLICA/NO APLICA VAC√çA:
"| Requisito ISO 9001 | APLICA | NO APLICA |
 | Certificaci√≥n      |        |           |" ‚Üê CAMPO VAC√çO (ERROR CR√çTICO)

‚ùå TABLA APLICA/NO APLICA AMBIGUA:
"| Requisito | APLICA | NO APLICA |
 | Req 1    |   X    |     X     |" ‚Üê AMBOS MARCADOS (ERROR CR√çTICO)

‚ùå SECCI√ìN OBLIGATORIA FALTANTE:
Pliego sin apartado "GARANT√çAS" (ERROR CR√çTICO)

‚ùå INCOHERENCIA NUM√âRICA EN PRESUPUESTO:
"2.- DADES ECON√íMIQUES:
 
PRESSUPOST DE LICITACI√ì: 243.936,00 euros (IVA incl√≤s), 201.600,00 euros (IVA no incl√≤s)
 
Lot | Descripci√≥                    | Pressupost (IVA incl√≤s)
1   | Carretera de Rub√≠ al Papiol   | 241.840,28
2   | Carretera del Papiol a Mira-Sol | 1.942,72

SUMA LOTES: 241.840,28 + 1.942,72 = 243.783,00 euros
PRESUPUESTO DECLARADO: 243.936,00 euros
DIFERENCIA: 153,00 euros ‚Üê ERROR CR√çTICO (>100‚Ç¨)"

‚úÖ COHERENCIA NUM√âRICA CORRECTA:
"PRESSUPOST DE LICITACI√ì: 243.936,00 euros (IVA incl√≤s)
 
Lot | Descripci√≥                    | Pressupost (IVA incl√≤s)
1   | Carretera de Rub√≠ al Papiol   | 241.840,28
2   | Carretera del Papiol a Mira-Sol | 2.095,72

SUMA LOTES: 241.840,28 + 2.095,72 = 243.936,00 euros
PRESUPUESTO DECLARADO: 243.936,00 euros
DIFERENCIA: 0,00 euros ‚Üê CORRECTO"

================================================================================
                                NOTAS
================================================================================

- Este sistema debe ejecutarse ANTES de la validaci√≥n estructural completa
- Los errores cr√≠ticos deben impedir continuar el proceso
- Las advertencias se incluyen en el informe pero no bloquean
- Actualizar patrones seg√∫n feedback del generador de pliegos
- Mantener estad√≠sticas de errores m√°s frecuentes

================================================================================
                                    FIN
================================================================================
