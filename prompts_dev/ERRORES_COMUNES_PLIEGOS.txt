================================================================================
                        ERRORES COMUNES EN PLIEGOS SAP
                    Sistema de Validaci√≥n Pre-Informe
================================================================================

OBJETIVO:
Detectar autom√°ticamente errores frecuentes ANTES de generar el informe completo
de validaci√≥n estructural. Estos errores son reportados directamente por el
generador de pliegos y requieren validaci√≥n autom√°tica prioritaria.

================================================================================
                            ERRORES IDENTIFICADOS
================================================================================

1. CANTIDAD DE LOTES:
   ‚ùå PROBLEMA: Inconsistencia entre el n√∫mero de lotes declarados y los realmente incluidos
   
   VALIDACIONES:
   - Contar menciones de "LOTE" en el documento
   - Verificar numeraci√≥n secuencial (Lote 1, Lote 2, etc.)
   - Detectar lotes duplicados o saltos en numeraci√≥n
   - Validar que cada lote tenga presupuesto asignado
   
   PATRONES A DETECTAR:
   - "LOTE \d+" (Lote 1, Lote 2, etc.)
   - "Lot \d+" (variante catalana)
   - Tablas con columnas de lotes
   - Presupuestos por lote

2. TAGS SAP SIN RELLENAR:
   ‚ùå PROBLEMA: Tags de variables SAP que no fueron reemplazados con datos reales
   
   VALIDACIONES:
   - Buscar patrones {{VARIABLE}}
   - Detectar [CAMPO_PENDIENTE]
   - Encontrar <<DATO_FALTANTE>>
   - Identificar {VALOR_VACIO}
   - Localizar @VARIABLE_SAP@
   
   PATRONES CR√çTICOS:
   - {{.*?}} (cualquier contenido entre llaves dobles)
   - \[.*?\] (contenido entre corchetes)
   - <<.*?>> (contenido entre dobles menor/mayor)
   - @.*?@ (contenido entre arrobas)
   - {.*?} (contenido entre llaves simples)

3. CAMPOS S√ç/NO DUPLICADOS:
   ‚ùå PROBLEMA: Marcar tanto S√ç como NO en campos excluyentes
   
   VALIDACIONES:
   - Detectar "‚òë S√ç" y "‚òë NO" en la misma secci√≥n
   - Buscar "X S√ç" y "X NO" simult√°neos
   - Identificar "[X] S√ç" y "[X] NO" marcados
   - Validar checkboxes duplicados en formularios
   
   PATRONES A DETECTAR:
   - (\[X\]|\‚òë|X)\s*(S√ç|SI).*?(\[X\]|\‚òë|X)\s*(NO)
   - Campos con ambas opciones marcadas
   - Secciones con respuestas contradictorias

4. FORMATO DE FECHA INCORRECTO:
   ‚ùå PROBLEMA: Fechas en formato incorrecto o inconsistente
   
   FORMATO CORRECTO CATAL√ÅN: DD/MM/AAAA
   
   VALIDACIONES:
   - Detectar fechas en formato americano (MM/DD/AAAA)
   - Identificar fechas con guiones (DD-MM-AAAA)
   - Validar fechas con formato ISO (AAAA-MM-DD)
   - Verificar fechas en ingl√©s (Month DD, YYYY)
   
   PATRONES INCORRECTOS:
   - \d{4}-\d{2}-\d{2} (formato ISO)
   - \d{1,2}-\d{1,2}-\d{4} (con guiones)
   - [A-Za-z]+ \d{1,2}, \d{4} (formato ingl√©s)
   - Fechas con meses en ingl√©s

5. FORMATO DE IMPORTES INCORRECTO:
   ‚ùå PROBLEMA: Importes sin formato euro correcto o con separadores incorrectos
   
   FORMATO CORRECTO: 123.456,78 ‚Ç¨ (punto miles, coma decimales)
   
   VALIDACIONES:
   - Detectar formato americano: 123,456.78 (coma miles, punto decimales)
   - Identificar ‚Ç¨ al inicio en lugar del final
   - Validar separadores incorrectos
   - Verificar espacios entre n√∫mero y s√≠mbolo
   
   PATRONES INCORRECTOS:
   - ‚Ç¨\s*\d+ (euro al inicio)
   - \d+,\d{3}\.\d{2} (formato americano)
   - \d+‚Ç¨ (sin espacio antes del euro)
   - EUR en lugar de ‚Ç¨

6. IDIOMA INCORRECTO (NO CATAL√ÅN):
   ‚ùå PROBLEMA: Texto en castellano o otros idiomas en lugar de catal√°n
   
   VALIDACIONES:
   - Detectar palabras en castellano comunes
   - Identificar t√©rminos t√©cnicos no traducidos
   - Validar nombres de meses en catal√°n
   - Verificar terminolog√≠a legal catalana
   
   PALABRAS CASTELLANAS COMUNES A DETECTAR:
   - "presupuesto" ‚Üí debe ser "pressupost"
   - "contrato" ‚Üí debe ser "contracte"
   - "licitaci√≥n" ‚Üí debe ser "licitaci√≥"
   - "adjudicaci√≥n" ‚Üí debe ser "adjudicaci√≥"
   - "enero, febrero..." ‚Üí debe ser "gener, febrer..."
   - "obras" ‚Üí debe ser "obres"
   - "proyecto" ‚Üí debe ser "projecte"

================================================================================
                        NIVELES DE CRITICIDAD
================================================================================

üî¥ CR√çTICO (Bloquea generaci√≥n):
- Tags SAP sin rellenar
- Campos S√ç/NO duplicados
- Cantidad de lotes incorrecta

üü° ADVERTENCIA (Permite continuar):
- Formato de fecha incorrecto
- Formato de importes incorrecto
- Palabras en castellano detectadas

================================================================================
                        INTEGRACI√ìN CON VALIDACI√ìN
================================================================================

FLUJO PROPUESTO:
1. Recibir documento para validaci√≥n
2. EJECUTAR validaci√≥n de errores comunes (PRE-VALIDACI√ìN)
3. Si hay errores cr√≠ticos ‚Üí Devolver lista de errores inmediatamente
4. Si solo hay advertencias ‚Üí Continuar con validaci√≥n estructural completa
5. Incluir errores comunes en el informe final

CONTEXTO RAG SUGERIDO:
- Subir este archivo a contexto: "ERRORES_COMUNES_PLIEGOS"
- Usar para entrenar detecci√≥n autom√°tica
- Actualizar patrones seg√∫n nuevos errores reportados

================================================================================
                        PATRONES REGEX ESPEC√çFICOS
================================================================================

TAGS SAP SIN RELLENAR:
- /\{\{[^}]*\}\}/g
- /\[[^\]]*\]/g
- /<<[^>]*>>/g
- /@[^@]*@/g

CAMPOS S√ç/NO DUPLICADOS:
- /(\[X\]|\‚òë|X)\s*(S√ç|SI)[\s\S]*?(\[X\]|\‚òë|X)\s*(NO)/gi

FECHAS INCORRECTAS:
- /\d{4}-\d{2}-\d{2}/g (ISO)
- /\d{1,2}-\d{1,2}-\d{4}/g (guiones)

IMPORTES INCORRECTOS:
- /‚Ç¨\s*\d+/g (euro al inicio)
- /\d+,\d{3}\.\d{2}/g (formato americano)

LOTES:
- /LOTE?\s*(\d+)/gi
- /LOT\s*(\d+)/gi

PALABRAS CASTELLANAS:
- /\b(presupuesto|contrato|licitaci√≥n|adjudicaci√≥n|obras|proyecto)\b/gi

================================================================================
                            EJEMPLOS DE ERRORES
================================================================================

‚ùå TAG SIN RELLENAR:
"El presupuesto total es de {{IMPORTE_TOTAL}} euros"

‚ùå S√ç/NO DUPLICADO:
"‚òë S√ç, se incluyen lotes
 ‚òë NO, no se incluyen lotes"

‚ùå FECHA INCORRECTA:
"Fecha l√≠mite: 2025-10-22" (debe ser "22/10/2025")

‚ùå IMPORTE INCORRECTO:
"Presupuesto: ‚Ç¨ 123,456.78" (debe ser "123.456,78 ‚Ç¨")

‚ùå LOTES INCONSISTENTES:
"Se divide en 3 lotes" pero solo aparecen "Lote 1" y "Lote 2"

‚ùå IDIOMA INCORRECTO:
"presupuesto de licitaci√≥n" (debe ser "pressupost de licitaci√≥")

================================================================================
                                NOTAS
================================================================================

- Este sistema debe ejecutarse ANTES de la validaci√≥n estructural completa
- Los errores cr√≠ticos deben impedir continuar el proceso
- Las advertencias se incluyen en el informe pero no bloquean
- Actualizar patrones seg√∫n feedback del generador de pliegos
- Mantener estad√≠sticas de errores m√°s frecuentes

================================================================================
                                    FIN
================================================================================
