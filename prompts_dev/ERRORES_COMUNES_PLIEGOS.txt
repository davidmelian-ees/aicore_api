================================================================================
                        ERRORES COMUNES EN PLIEGOS SAP
                    Sistema de Validaci√≥n Pre-Informe
================================================================================

OBJETIVO:
Detectar autom√°ticamente errores frecuentes ANTES de generar el informe completo
de validaci√≥n estructural. Estos errores son reportados directamente por el
generador de pliegos y requieren validaci√≥n autom√°tica prioritaria.

================================================================================
                            ERRORES IDENTIFICADOS
================================================================================

1. CANTIDAD DE LOTES:
   ‚ùå PROBLEMA: Inconsistencia entre el n√∫mero de lotes declarados y los realmente incluidos
   
   VALIDACIONES:
   - Contar menciones de "LOTE" en el documento
   - Verificar numeraci√≥n secuencial (Lote 1, Lote 2, etc.)
   - Detectar lotes duplicados o saltos en numeraci√≥n
   - Validar que cada lote tenga presupuesto asignado
   
   PATRONES A DETECTAR:
   - "LOTE \d+" (Lote 1, Lote 2, etc.)
   - "Lot \d+" (variante catalana)
   - Tablas con columnas de lotes
   - Presupuestos por lote

2. TAGS SAP SIN RELLENAR:
   ‚ùå PROBLEMA: Tags de variables SAP que no fueron reemplazados con datos reales
   
   VALIDACIONES:
   - Buscar patrones {{VARIABLE}}
   - Detectar [CAMPO_PENDIENTE]
   - Encontrar <<DATO_FALTANTE>>
   - Identificar {VALOR_VACIO}
   - Localizar @VARIABLE_SAP@
   
   PATRONES CR√çTICOS:
   - {{.*?}} (cualquier contenido entre llaves dobles)
   - \[.*?\] (contenido entre corchetes)
   - <<.*?>> (contenido entre dobles menor/mayor)
   - @.*?@ (contenido entre arrobas)
   - {.*?} (contenido entre llaves simples)

3. CAMPOS S√ç/NO DUPLICADOS:
   ‚ùå PROBLEMA: Marcar tanto S√ç como NO en campos excluyentes
   
   VALIDACIONES:
   - Detectar "‚òë S√ç" y "‚òë NO" en la misma secci√≥n
   - Buscar "X S√ç" y "X NO" simult√°neos
   - Identificar "[X] S√ç" y "[X] NO" marcados
   - Validar checkboxes duplicados en formularios
   
   PATRONES A DETECTAR:
   - (\[X\]|\‚òë|X)\s*(S√ç|SI).*?(\[X\]|\‚òë|X)\s*(NO)
   - Campos con ambas opciones marcadas
   - Secciones con respuestas contradictorias

4. FORMATO DE FECHA INCORRECTO:
   ‚ùå PROBLEMA: Fechas en formato incorrecto o inconsistente
   
   FORMATO CORRECTO CATAL√ÅN: DD/MM/AAAA
   
   VALIDACIONES:
   - Detectar fechas en formato americano (MM/DD/AAAA)
   - Identificar fechas con guiones (DD-MM-AAAA)
   - Validar fechas con formato ISO (AAAA-MM-DD)
   - Verificar fechas en ingl√©s (Month DD, YYYY)
   
   PATRONES INCORRECTOS:
   - \d{4}-\d{2}-\d{2} (formato ISO)
   - \d{1,2}-\d{1,2}-\d{4} (con guiones)
   - [A-Za-z]+ \d{1,2}, \d{4} (formato ingl√©s)
   - Fechas con meses en ingl√©s

5. FORMATO DE IMPORTES INCORRECTO:
   ‚ùå PROBLEMA: Importes sin formato euro correcto o con separadores incorrectos
   
   FORMATO CORRECTO: 123.456,78 ‚Ç¨ (punto miles, coma decimales)
   
   VALIDACIONES:
   - Detectar formato americano: 123,456.78 (coma miles, punto decimales)
   - Identificar ‚Ç¨ al inicio en lugar del final
   - Validar separadores incorrectos
   - Verificar espacios entre n√∫mero y s√≠mbolo
   
   PATRONES INCORRECTOS:
   - ‚Ç¨\s*\d+ (euro al inicio)
   - \d+,\d{3}\.\d{2} (formato americano)
   - \d+‚Ç¨ (sin espacio antes del euro)
   - EUR en lugar de ‚Ç¨

6. IDIOMA INCORRECTO (NO CATAL√ÅN):
   ‚ùå PROBLEMA: Texto en castellano o otros idiomas en lugar de catal√°n
   
   VALIDACIONES:
   - Detectar palabras en castellano comunes
   - Identificar t√©rminos t√©cnicos no traducidos
   - Validar nombres de meses en catal√°n
   - Verificar terminolog√≠a legal catalana
   
   PALABRAS CASTELLANAS COMUNES A DETECTAR:
   - "presupuesto" ‚Üí debe ser "pressupost"
   - "contrato" ‚Üí debe ser "contracte"
   - "licitaci√≥n" ‚Üí debe ser "licitaci√≥"
   - "adjudicaci√≥n" ‚Üí debe ser "adjudicaci√≥"
   - "enero, febrero..." ‚Üí debe ser "gener, febrer..."
   - "obras" ‚Üí debe ser "obres"
   - "proyecto" ‚Üí debe ser "projecte"

7. NUMERACI√ìN SECUENCIAL INCORRECTA:
   ‚ùå PROBLEMA: Saltos en la numeraci√≥n de puntos del pliego
   
   VALIDACIONES:
   - Detectar saltos en numeraci√≥n principal (ej: 1. 2. 4. ‚Üê falta el 3.)
   - Verificar subnumeraci√≥n correcta (ej: 3.1, 3.2, 3.3)
   - Validar jerarqu√≠a de niveles (ej: 3.1.1, 3.1.2)
   - Alertar sobre posibles puntos faltantes
   
   EJEMPLOS CORRECTOS:
   ‚úÖ 1.
   ‚úÖ 2.
   ‚úÖ 3.
   ‚úÖ 3.1
   ‚úÖ 3.1.1
   ‚úÖ 3.1.2
   ‚úÖ 3.2
   ‚úÖ 4.
   
   EJEMPLOS INCORRECTOS:
   ‚ùå 1.
   ‚ùå 4. ‚Üê FALTA 2. y 3.
   
   ‚ùå 3.
   ‚ùå 3.1
   ‚ùå 3.3 ‚Üê FALTA 3.2
   
   SEVERIDAD:
   - Salto de 1 punto: ‚ö†Ô∏è ADVERTENCIA (puede ser intencional)
   - Salto de 2+ puntos: üî¥ ERROR CR√çTICO (probablemente faltan secciones)

8. TABLAS APLICA/NO APLICA INCOMPLETAS:
   ‚ùå PROBLEMA: Campos vac√≠os en tablas que requieren "APLICA" o "NO APLICA"
   
   VALIDACIONES:
   - Detectar tablas con columnas APLICA/NO APLICA
   - Verificar que TODOS los campos est√©n rellenados
   - Identificar celdas vac√≠as o con solo espacios
   - Validar que no haya valores ambiguos
   
   PATRONES A DETECTAR:
   - Tablas con encabezados "APLICA" o "NO APLICA"
   - Celdas vac√≠as en columnas de aplicabilidad
   - Valores incorrectos (ej: "S√ç", "NO", "N/A" en lugar de "APLICA"/"NO APLICA")
   
   EJEMPLOS CORRECTOS:
   ‚úÖ | Requisito | APLICA | NO APLICA |
      | Req 1    |   X    |           |
      | Req 2    |        |     X     |
   
   EJEMPLOS INCORRECTOS:
   ‚ùå | Requisito | APLICA | NO APLICA |
      | Req 1    |        |           | ‚Üê CAMPO VAC√çO
      | Req 2    |   X    |     X     | ‚Üê AMBOS MARCADOS
   
   SEVERIDAD:
   - Campo vac√≠o: üî¥ ERROR CR√çTICO (debe estar rellenado)
   - Ambos marcados: üî¥ ERROR CR√çTICO (excluyentes)
   - Valor incorrecto: üü° ADVERTENCIA (formato no est√°ndar)

9. SECCIONES OBLIGATORIAS FALTANTES:
   ‚ùå PROBLEMA: Faltan apartados obligatorios seg√∫n el tipo de pliego
   
   SECCIONES OBLIGATORIAS EN TODOS LOS PLIEGOS:
   - OBJETO DEL CONTRATO
   - PRESUPUESTO
   - PLAZO DE EJECUCI√ìN
   - CONDICIONES T√âCNICAS
   - CRITERIOS DE ADJUDICACI√ìN
   - GARANT√çAS
   - PENALIDADES
   - MODIFICACI√ìN DEL CONTRATO
   - SUBCONTRATACI√ìN
   - REVISI√ìN DE PRECIOS
   
   VALIDACIONES:
   - Verificar presencia de todas las secciones obligatorias
   - Detectar secciones con contenido vac√≠o
   - Validar que las secciones est√©n en orden l√≥gico
   - Identificar secciones duplicadas
   
   SEVERIDAD:
   - Secci√≥n obligatoria faltante: üî¥ ERROR CR√çTICO
   - Secci√≥n vac√≠a: üü° ADVERTENCIA
   - Secci√≥n duplicada: üü° ADVERTENCIA
   - Orden incorrecto: üü° ADVERTENCIA

================================================================================
                        NIVELES DE CRITICIDAD
================================================================================

üî¥ CR√çTICO (Bloquea generaci√≥n):
- Tags SAP sin rellenar
- Campos S√ç/NO duplicados
- Cantidad de lotes incorrecta
- Saltos de 2+ puntos en numeraci√≥n (probablemente faltan secciones)
- Tablas APLICA/NO APLICA con campos vac√≠os
- Tablas APLICA/NO APLICA con ambas opciones marcadas
- Secciones obligatorias faltantes

üü° ADVERTENCIA (Permite continuar):
- Formato de fecha incorrecto
- Formato de importes incorrecto
- Palabras en castellano detectadas
- Salto de 1 punto en numeraci√≥n (puede ser intencional)
- Secciones vac√≠as
- Secciones duplicadas
- Orden incorrecto de secciones
- Valores no est√°ndar en tablas APLICA/NO APLICA

================================================================================
                        INTEGRACI√ìN CON VALIDACI√ìN
================================================================================

FLUJO PROPUESTO:
1. Recibir documento para validaci√≥n
2. EJECUTAR validaci√≥n de errores comunes (PRE-VALIDACI√ìN)
3. Si hay errores cr√≠ticos ‚Üí Devolver lista de errores inmediatamente
4. Si solo hay advertencias ‚Üí Continuar con validaci√≥n estructural completa
5. Incluir errores comunes en el informe final

CONTEXTO RAG SUGERIDO:
- Subir este archivo a contexto: "ERRORES_COMUNES_PLIEGOS"
- Usar para entrenar detecci√≥n autom√°tica
- Actualizar patrones seg√∫n nuevos errores reportados

================================================================================
                        PATRONES REGEX ESPEC√çFICOS
================================================================================

TAGS SAP SIN RELLENAR:
- /\{\{[^}]*\}\}/g
- /\[[^\]]*\]/g
- /<<[^>]*>>/g
- /@[^@]*@/g

CAMPOS S√ç/NO DUPLICADOS:
- /(\[X\]|\‚òë|X)\s*(S√ç|SI)[\s\S]*?(\[X\]|\‚òë|X)\s*(NO)/gi

FECHAS INCORRECTAS:
- /\d{4}-\d{2}-\d{2}/g (ISO)
- /\d{1,2}-\d{1,2}-\d{4}/g (guiones)

IMPORTES INCORRECTOS:
- /‚Ç¨\s*\d+/g (euro al inicio)
- /\d+,\d{3}\.\d{2}/g (formato americano)

LOTES:
- /LOTE?\s*(\d+)/gi
- /LOT\s*(\d+)/gi

PALABRAS CASTELLANAS:
- /\b(presupuesto|contrato|licitaci√≥n|adjudicaci√≥n|obras|proyecto)\b/gi

NUMERACI√ìN:
- /^(\d+(?:\.\d+)*)\.\s+/gm (detectar numeraci√≥n: 1., 2.1, 3.1.1, etc.)
- Validar secuencia: extraer n√∫meros y verificar continuidad

TABLAS APLICA/NO APLICA:
- /APLICA|NO APLICA/gi (detectar tablas con estos encabezados)
- /\|\s*\|\s*\|/g (detectar celdas vac√≠as en tablas)
- /APLICA:\s*$/gim (detectar campos APLICA vac√≠os)
- /NO APLICA:\s*$/gim (detectar campos NO APLICA vac√≠os)

SECCIONES OBLIGATORIAS:
- Buscar texto exacto (case-insensitive):
  - "OBJETO DEL CONTRATO" o "OBJECTE DEL CONTRACTE"
  - "PRESUPUESTO" o "PRESSUPOST"
  - "PLAZO DE EJECUCI√ìN" o "TERMINI D'EXECUCI√ì"
  - "CONDICIONES T√âCNICAS" o "CONDICIONS T√àCNIQUES"
  - "CRITERIOS DE ADJUDICACI√ìN" o "CRITERIS D'ADJUDICACI√ì"
  - "GARANT√çAS" o "GARANTIES"
  - "PENALIDADES" o "PENALITATS"
  - "MODIFICACI√ìN DEL CONTRATO" o "MODIFICACI√ì DEL CONTRACTE"
  - "SUBCONTRATACI√ìN" o "SUBCONTRACTACI√ì"
  - "REVISI√ìN DE PRECIOS" o "REVISI√ì DE PREUS"

================================================================================
                            EJEMPLOS DE ERRORES
================================================================================

‚ùå TAG SIN RELLENAR:
"El presupuesto total es de {{IMPORTE_TOTAL}} euros"

‚ùå S√ç/NO DUPLICADO:
"‚òë S√ç, se incluyen lotes
 ‚òë NO, no se incluyen lotes"

‚ùå FECHA INCORRECTA:
"Fecha l√≠mite: 2025-10-22" (debe ser "22/10/2025")

‚ùå IMPORTE INCORRECTO:
"Presupuesto: ‚Ç¨ 123,456.78" (debe ser "123.456,78 ‚Ç¨")

‚ùå LOTES INCONSISTENTES:
"Se divide en 3 lotes" pero solo aparecen "Lote 1" y "Lote 2"

‚ùå IDIOMA INCORRECTO:
"presupuesto de licitaci√≥n" (debe ser "pressupost de licitaci√≥")

‚ùå NUMERACI√ìN CON SALTO:
"1. Introducci√≥n
 2. Objeto del contrato
 5. Presupuesto" ‚Üê FALTA 3. y 4. (ERROR CR√çTICO)

‚ùå TABLA APLICA/NO APLICA VAC√çA:
"| Requisito ISO 9001 | APLICA | NO APLICA |
 | Certificaci√≥n      |        |           |" ‚Üê CAMPO VAC√çO (ERROR CR√çTICO)

‚ùå TABLA APLICA/NO APLICA AMBIGUA:
"| Requisito | APLICA | NO APLICA |
 | Req 1    |   X    |     X     |" ‚Üê AMBOS MARCADOS (ERROR CR√çTICO)

‚ùå SECCI√ìN OBLIGATORIA FALTANTE:
Pliego sin apartado "GARANT√çAS" (ERROR CR√çTICO)

================================================================================
                                NOTAS
================================================================================

- Este sistema debe ejecutarse ANTES de la validaci√≥n estructural completa
- Los errores cr√≠ticos deben impedir continuar el proceso
- Las advertencias se incluyen en el informe pero no bloquean
- Actualizar patrones seg√∫n feedback del generador de pliegos
- Mantener estad√≠sticas de errores m√°s frecuentes

================================================================================
                                    FIN
================================================================================
