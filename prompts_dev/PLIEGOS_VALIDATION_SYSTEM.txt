================================================================================
                    SISTEMA DE VALIDACIÓN ESTRUCTURAL DE PLIEGOS
                        Integración con SAP - Validación de Plantillas
================================================================================

OBJETIVO PRINCIPAL:
Validar que los pliegos generados desde SAP cumplan con las plantillas establecidas,
no desde el punto de vista ortográfico/gramatical, sino estructural y de contenido.

================================================================================
                              TIPOS DE PLIEGOS
================================================================================

CUATRO TIPOS DE PLIEGOS BASE:
1. OBRA_CIVIL_OBERT (Obra Civil Abierto)
2. OBRA_CIVIL_SIMPLIFICAT (Obra Civil Simplificado)
3. OBRA_EDIFICACIO_OBERT (Obra Edificación Abierto)
4. OBRA_EDIFICACIO_SIMPLIFICAT (Obra Edificación Simplificado)

VARIANTES POR TIPO:
- CON_LOTES: Incluye secciones específicas para manejo de lotes
- SIN_LOTES: Versión simplificada sin secciones de lotes

TOTAL DE COMBINACIONES: 8 plantillas (4 tipos × 2 variantes)

================================================================================
                        CONVENCIÓN DE NOMENCLATURA
================================================================================

FORMATO GENERAL:
pliego_{TIPO}_{MODALIDAD}_{CATEGORIA}

COMPONENTES:
- TIPO: obra_civil_obert | obra_civil_simplificat | obra_edificacio_obert | obra_edificacio_simplificat
- MODALIDAD: con_lotes | sin_lotes  
- CATEGORIA: PLANTILLA | PLANTILLA_TAGS | GENERADO | VALIDACION

EJEMPLOS DE NOMBRES:
✅ pliego_obra_civil_obert_con_lotes_PLANTILLA
✅ pliego_obra_civil_obert_con_lotes_PLANTILLA_TAGS  
✅ pliego_obra_civil_simplificat_sin_lotes_GENERADO
✅ pliego_obra_edificacio_obert_con_lotes_PLANTILLA
✅ pliego_obra_edificacio_simplificat_sin_lotes_VALIDACION

CATEGORÍAS EXPLICADAS:
- PLANTILLA: Documento base limpio sin datos específicos
- PLANTILLA_TAGS: Plantilla con marcadores SAP {{VARIABLE}}
- GENERADO: Pliego final con datos SAP insertados (referencia correcta)
- VALIDACION: Documento a validar (puede tener errores)

================================================================================
                            VALIDACIONES REQUERIDAS
================================================================================

1. RESPETO A PLANTILLA:
   - Verificar que la estructura del pliego coincida con la plantilla correspondiente
   - Identificar secciones faltantes o mal ubicadas
   - Validar orden correcto de apartados

2. VALIDACIÓN DE LOTES:
   - Detectar automáticamente si el pliego debe incluir lotes
   - Verificar que las secciones de lotes estén completas
   - Validar formato y estructura de información de lotes

3. COMPLETITUD DE APARTADOS:
   - Verificar que no falte ningún apartado obligatorio
   - Identificar apartados opcionales presentes/ausentes
   - Validar jerarquía de secciones y subsecciones

4. IDENTIFICACIÓN DE CAMPOS VARIABLES:
   - Detectar campos que cambian entre pliegos del mismo tipo
   - Distinguir entre contenido estático (plantilla) y dinámico (SAP)
   - Catalogar tipos de variables encontradas

5. CONSISTENCIA CON PLIEGOS ANTERIORES:
   - Comparar con pliegos históricos del mismo tipo
   - Identificar desviaciones significativas
   - Validar coherencia en formato y estructura

================================================================================
                            TIPOS DE DOCUMENTOS
================================================================================

1. PLANTILLAS BASE:
   - Documentos Word con estructura fija
   - Contienen apartados estáticos obligatorios
   - Definen el esqueleto de cada tipo de pliego
   - Identificables por: estructura, títulos fijos, formato

2. PLANTILLAS CON TAGS SAP:
   - Documentos Word con marcadores SAP
   - Formato: {{CAMPO_SAP}}, [VARIABLE], {TAG_NAME}
   - Muestran dónde se insertan datos dinámicos
   - Identificables por: presencia de tags, sintaxis específica

3. PLIEGOS GENERADOS:
   - Documentos finales con datos de SAP insertados
   - Tags reemplazados por valores reales
   - Pueden tener errores de generación
   - Identificables por: ausencia de tags, datos específicos

4. DOCUMENTOS DE REFERENCIA:
   - Pliegos históricos correctos
   - Ejemplos de buenas prácticas
   - Base para comparaciones
   - Identificables por: completitud, validación previa

================================================================================
                            CAMPOS VARIABLES DETECTADOS
================================================================================

TIPOS DE VARIABLES ESPERADAS:
- Fechas: {{FECHA_INICIO}}, {{FECHA_FIN}}, {{FECHA_PUBLICACION}}
- Importes: {{PRESUPUESTO_BASE}}, {{VALOR_ESTIMADO}}, {{IVA}}
- Identificadores: {{EXPEDIENTE}}, {{CPV}}, {{LICITACION_ID}}
- Textos: {{OBJETO_CONTRATO}}, {{DESCRIPCION}}, {{CRITERIOS}}
- Lotes: {{LOTE_1}}, {{LOTE_2}}, {{DESCRIPCION_LOTE}}
- Organizacionales: {{ORGANISMO}}, {{UNIDAD}}, {{RESPONSABLE}}

ARCHIVO DE SALIDA:
- Ruta: ./validation_results/campos_variables_detectados.txt
- Formato: CAMPO | TIPO | FRECUENCIA | PLANTILLA_ORIGEN
- Actualización: Cada validación añade nuevos campos detectados

================================================================================
                            PROCESO DE ENTRENAMIENTO
================================================================================

FASE 1 - CARGA DE PLANTILLAS:
1. Subir las 4 plantillas base al contexto "PLANTILLAS_PLIEGOS"
2. Subir variantes con/sin lotes al contexto "PLANTILLAS_VARIANTES"
3. Analizar y extraer estructura fija de cada plantilla
4. Crear mapas de apartados obligatorios por tipo

FASE 2 - ANÁLISIS DE TAGS:
1. Subir documentos con tags SAP al contexto "TAGS_SAP"
2. Extraer y catalogar todos los tags encontrados
3. Crear diccionario de variables por tipo de pliego
4. Establecer patrones de reemplazo

FASE 3 - EJEMPLOS DE REFERENCIA:
1. Subir pliegos históricos correctos al contexto "PLIEGOS_REFERENCIA"
2. Asociar cada ejemplo con su tipo de plantilla
3. Crear base de conocimiento de buenas prácticas
4. Establecer métricas de calidad

FASE 4 - CASOS DE ERROR:
1. Subir ejemplos de pliegos con errores al contexto "ERRORES_COMUNES"
2. Documentar tipos de errores frecuentes
3. Crear patrones de detección de problemas
4. Establecer niveles de severidad

================================================================================
                            ALGORITMO DE VALIDACIÓN
================================================================================

PASO 1 - IDENTIFICACIÓN DE TIPO:
- Analizar estructura del documento
- Buscar patrones característicos de cada plantilla
- Detectar presencia/ausencia de secciones de lotes
- Clasificar documento en uno de los 8 tipos posibles

PASO 2 - EXTRACCIÓN DE ESTRUCTURA:
- Identificar títulos y apartados principales
- Extraer jerarquía de secciones
- Mapear contenido a estructura esperada
- Detectar apartados faltantes o adicionales

PASO 3 - ANÁLISIS DE CONTENIDO:
- Separar contenido estático de dinámico
- Identificar campos variables y sus valores
- Validar formato y coherencia de datos
- Comparar con patrones históricos

PASO 4 - GENERACIÓN DE REPORTE:
- Crear informe de validación estructural
- Listar errores encontrados por categoría
- Sugerir correcciones específicas
- Generar archivo de campos variables

================================================================================
                            ESTRUCTURA DE RESPUESTA
================================================================================

FORMATO DE VALIDACIÓN:
{
  "tipoPliego": "TIPO_A_CON_LOTES",
  "validacionEstructural": {
    "cumplePlantilla": true/false,
    "apartadosFaltantes": ["apartado1", "apartado2"],
    "apartadosAdicionales": ["apartado3"],
    "ordenCorrecto": true/false
  },
  "validacionLotes": {
    "requiereLotes": true/false,
    "lotesPresentes": true/false,
    "lotesCompletos": true/false,
    "erroresLotes": ["error1", "error2"]
  },
  "camposVariables": [
    {
      "campo": "{{PRESUPUESTO_BASE}}",
      "valor": "150.000 €",
      "tipo": "IMPORTE",
      "ubicacion": "Apartado 3.2"
    }
  ],
  "puntuacionCalidad": 85,
  "recomendaciones": ["rec1", "rec2"],
  "erroresCriticos": ["error1"],
  "advertencias": ["warn1", "warn2"]
}

================================================================================
                            CONFIGURACIÓN TÉCNICA
================================================================================

CONTEXTOS RAG NECESARIOS:
- PLANTILLAS_PLIEGOS: Plantillas base de los 4 tipos
- PLANTILLAS_VARIANTES: Variantes con/sin lotes
- TAGS_SAP: Documentos con marcadores SAP
- PLIEGOS_REFERENCIA: Ejemplos históricos correctos
- ERRORES_COMUNES: Casos de error documentados

ARCHIVOS DE SALIDA:
- ./validation_results/campos_variables_detectados.txt
- ./validation_results/reporte_validacion_[timestamp].json
- ./validation_results/errores_estructurales_[timestamp].txt

MÉTRICAS DE CALIDAD:
- Completitud estructural (0-100)
- Adherencia a plantilla (0-100)
- Calidad de lotes (0-100 si aplica)
- Consistencia histórica (0-100)
- Puntuación global (promedio ponderado)

================================================================================
                            CASOS DE USO ESPECÍFICOS
================================================================================

CASO 1 - PLIEGO NUEVO:
- Validar contra plantilla correspondiente
- Identificar todos los campos variables
- Generar reporte completo de validación
- Crear baseline para futuras comparaciones

CASO 2 - PLIEGO MODIFICADO:
- Comparar con versión anterior
- Identificar cambios estructurales
- Validar que modificaciones sean apropiadas
- Alertar sobre desviaciones significativas

CASO 3 - LOTE AÑADIDO/ELIMINADO:
- Detectar cambio en estructura de lotes
- Validar coherencia con tipo de pliego
- Verificar completitud de información de lotes
- Actualizar clasificación del documento

CASO 4 - ERROR DE GENERACIÓN SAP:
- Detectar tags no reemplazados
- Identificar campos con formato incorrecto
- Validar coherencia de datos insertados
- Sugerir correcciones específicas

================================================================================
                            NOTAS IMPORTANTES
================================================================================

PRINCIPIOS CLAVE:
1. NO INVENTAR contenido estático - debe coincidir exactamente con plantillas
2. IDENTIFICAR automáticamente el tipo de pliego por patrones estructurales
3. DISTINGUIR claramente entre contenido fijo y variable
4. MANTENER historial de campos variables para mejora continua
5. PROPORCIONAR feedback específico y accionable

LIMITACIONES:
- Requiere entrenamiento inicial con todas las plantillas
- Necesita ejemplos de cada tipo de pliego para calibración
- Dependiente de la calidad de los documentos de referencia
- Puede requerir ajustes según evolución de plantillas SAP

EVOLUCIÓN:
- Sistema debe aprender de nuevos casos
- Plantillas pueden actualizarse y requerir reentrenamiento
- Campos variables pueden cambiar según actualizaciones SAP
- Métricas de calidad deben refinarse con uso

================================================================================
                                    FIN
================================================================================
