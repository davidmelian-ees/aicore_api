================================================================================
                    SISTEMA DE VALIDACI√ìN ESTRUCTURAL DE PLIEGOS
                        Integraci√≥n con SAP - Validaci√≥n de Plantillas
================================================================================

OBJETIVO PRINCIPAL:
Validar que los pliegos generados desde SAP cumplan con las plantillas establecidas,
no desde el punto de vista ortogr√°fico/gramatical, sino estructural y de contenido.

================================================================================
                              TIPOS DE PLIEGOS
================================================================================

CUATRO TIPOS DE PLIEGOS BASE:
1. OBRA_CIVIL_OBERT (Obra Civil Abierto)
2. OBRA_CIVIL_SIMPLIFICAT (Obra Civil Simplificado)
3. OBRA_EDIFICACIO_OBERT (Obra Edificaci√≥n Abierto)
4. OBRA_EDIFICACIO_SIMPLIFICAT (Obra Edificaci√≥n Simplificado)

VARIANTES POR TIPO:
- CON_LOTES: Incluye secciones espec√≠ficas para manejo de lotes
- SIN_LOTES: Versi√≥n simplificada sin secciones de lotes

TOTAL DE COMBINACIONES: 8 plantillas (4 tipos √ó 2 variantes)

================================================================================
                        CONVENCI√ìN DE NOMENCLATURA
================================================================================

FORMATO GENERAL:
pliego_{TIPO}_{MODALIDAD}_{CATEGORIA}

COMPONENTES:
- TIPO: obra_civil_obert | obra_civil_simplificat | obra_edificacio_obert | obra_edificacio_simplificat
- MODALIDAD: con_lotes | sin_lotes  
- CATEGORIA: PLANTILLA | PLANTILLA_TAGS | GENERADO | VALIDACION

EJEMPLOS DE NOMBRES:
‚úÖ pliego_obra_civil_obert_con_lotes_PLANTILLA
‚úÖ pliego_obra_civil_obert_con_lotes_PLANTILLA_TAGS  
‚úÖ pliego_obra_civil_simplificat_sin_lotes_GENERADO
‚úÖ pliego_obra_edificacio_obert_con_lotes_PLANTILLA
‚úÖ pliego_obra_edificacio_simplificat_sin_lotes_VALIDACION

CATEGOR√çAS EXPLICADAS:
- PLANTILLA: Documento base limpio sin datos espec√≠ficos
- PLANTILLA_TAGS: Plantilla con marcadores SAP {{VARIABLE}}
- GENERADO: Pliego final con datos SAP insertados (referencia correcta)
- VALIDACION: Documento a validar (puede tener errores)

================================================================================
                            VALIDACIONES REQUERIDAS
================================================================================

0. PRE-VALIDACI√ìN DE ERRORES COMUNES (NUEVA):
   üî¥ ERRORES CR√çTICOS (Bloquean validaci√≥n):
   - Tags SAP sin rellenar ({{VARIABLE}}, [CAMPO], etc.)
   - Campos S√ç/NO marcados simult√°neamente
   - Cantidad de lotes inconsistente (secuencia incompleta)
   
   üü° ADVERTENCIAS (Permiten continuar):
   - Formato de fecha incorrecto (debe ser DD/MM/AAAA)
   - Formato de importes incorrecto (debe ser 123.456,78 ‚Ç¨)
   - Palabras en castellano (debe estar en catal√°n)

1. RESPETO A PLANTILLA:
   - Verificar que la estructura del pliego coincida con la plantilla correspondiente
   - Identificar secciones faltantes o mal ubicadas
   - Validar orden correcto de apartados

2. VALIDACI√ìN DE LOTES:
   - Detectar autom√°ticamente si el pliego debe incluir lotes
   - Verificar que las secciones de lotes est√©n completas
   - Validar formato y estructura de informaci√≥n de lotes

3. COMPLETITUD DE APARTADOS:
   - Verificar que no falte ning√∫n apartado obligatorio
   - Identificar apartados opcionales presentes/ausentes
   - Validar jerarqu√≠a de secciones y subsecciones

4. IDENTIFICACI√ìN DE CAMPOS VARIABLES:
   - Detectar campos que cambian entre pliegos del mismo tipo
   - Distinguir entre contenido est√°tico (plantilla) y din√°mico (SAP)
   - Catalogar tipos de variables encontradas

5. CONSISTENCIA CON PLIEGOS ANTERIORES:
   - Comparar con pliegos hist√≥ricos del mismo tipo
   - Identificar desviaciones significativas
   - Validar coherencia en formato y estructura

================================================================================
                            TIPOS DE DOCUMENTOS
================================================================================

1. PLANTILLAS BASE:
   - Documentos Word con estructura fija
   - Contienen apartados est√°ticos obligatorios
   - Definen el esqueleto de cada tipo de pliego
   - Identificables por: estructura, t√≠tulos fijos, formato

2. PLANTILLAS CON TAGS SAP:
   - Documentos Word con marcadores SAP
   - Formato: {{CAMPO_SAP}}, [VARIABLE], {TAG_NAME}
   - Muestran d√≥nde se insertan datos din√°micos
   - Identificables por: presencia de tags, sintaxis espec√≠fica

3. PLIEGOS GENERADOS:
   - Documentos finales con datos de SAP insertados
   - Tags reemplazados por valores reales
   - Pueden tener errores de generaci√≥n
   - Identificables por: ausencia de tags, datos espec√≠ficos

4. DOCUMENTOS DE REFERENCIA:
   - Pliegos hist√≥ricos correctos
   - Ejemplos de buenas pr√°cticas
   - Base para comparaciones
   - Identificables por: completitud, validaci√≥n previa

================================================================================
                            CAMPOS VARIABLES DETECTADOS
================================================================================

TIPOS DE VARIABLES ESPERADAS:
- Fechas: {{FECHA_INICIO}}, {{FECHA_FIN}}, {{FECHA_PUBLICACION}}
- Importes: {{PRESUPUESTO_BASE}}, {{VALOR_ESTIMADO}}, {{IVA}}
- Identificadores: {{EXPEDIENTE}}, {{CPV}}, {{LICITACION_ID}}
- Textos: {{OBJETO_CONTRATO}}, {{DESCRIPCION}}, {{CRITERIOS}}
- Lotes: {{LOTE_1}}, {{LOTE_2}}, {{DESCRIPCION_LOTE}}
- Organizacionales: {{ORGANISMO}}, {{UNIDAD}}, {{RESPONSABLE}}

ARCHIVO DE SALIDA:
- Ruta: ./validation_results/campos_variables_detectados.txt
- Formato: CAMPO | TIPO | FRECUENCIA | PLANTILLA_ORIGEN
- Actualizaci√≥n: Cada validaci√≥n a√±ade nuevos campos detectados

================================================================================
                            PROCESO DE ENTRENAMIENTO
================================================================================

FASE 1 - CARGA DE PLANTILLAS:
1. Subir las 4 plantillas base al contexto "PLANTILLAS_PLIEGOS"
2. Subir variantes con/sin lotes al contexto "PLANTILLAS_VARIANTES"
3. Analizar y extraer estructura fija de cada plantilla
4. Crear mapas de apartados obligatorios por tipo

FASE 2 - AN√ÅLISIS DE TAGS:
1. Subir documentos con tags SAP al contexto "TAGS_SAP"
2. Extraer y catalogar todos los tags encontrados
3. Crear diccionario de variables por tipo de pliego
4. Establecer patrones de reemplazo

FASE 3 - EJEMPLOS DE REFERENCIA:
1. Subir pliegos hist√≥ricos correctos al contexto "PLIEGOS_REFERENCIA"
2. Asociar cada ejemplo con su tipo de plantilla
3. Crear base de conocimiento de buenas pr√°cticas
4. Establecer m√©tricas de calidad

FASE 4 - CASOS DE ERROR:
1. Subir ejemplos de pliegos con errores al contexto "ERRORES_COMUNES"
2. Documentar tipos de errores frecuentes
3. Crear patrones de detecci√≥n de problemas
4. Establecer niveles de severidad

================================================================================
                            ALGORITMO DE VALIDACI√ìN
================================================================================

PASO 1 - IDENTIFICACI√ìN DE TIPO:
- Analizar estructura del documento
- Buscar patrones caracter√≠sticos de cada plantilla
- Detectar presencia/ausencia de secciones de lotes
- Clasificar documento en uno de los 8 tipos posibles

PASO 2 - EXTRACCI√ìN DE ESTRUCTURA:
- Identificar t√≠tulos y apartados principales
- Extraer jerarqu√≠a de secciones
- Mapear contenido a estructura esperada
- Detectar apartados faltantes o adicionales

PASO 3 - AN√ÅLISIS DE CONTENIDO:
- Separar contenido est√°tico de din√°mico
- Identificar campos variables y sus valores
- Validar formato y coherencia de datos
- Comparar con patrones hist√≥ricos

PASO 4 - GENERACI√ìN DE REPORTE:
- Crear informe de validaci√≥n estructural
- Listar errores encontrados por categor√≠a
- Sugerir correcciones espec√≠ficas
- Generar archivo de campos variables

================================================================================
                            ESTRUCTURA DE RESPUESTA
================================================================================

FORMATO DE VALIDACI√ìN:
{
  "tipoPliego": "TIPO_A_CON_LOTES",
  "validacionEstructural": {
    "cumplePlantilla": true/false,
    "apartadosFaltantes": ["apartado1", "apartado2"],
    "apartadosAdicionales": ["apartado3"],
    "ordenCorrecto": true/false
  },
  "validacionLotes": {
    "requiereLotes": true/false,
    "lotesPresentes": true/false,
    "lotesCompletos": true/false,
    "erroresLotes": ["error1", "error2"]
  },
  "camposVariables": [
    {
      "campo": "{{PRESUPUESTO_BASE}}",
      "valor": "150.000 ‚Ç¨",
      "tipo": "IMPORTE",
      "ubicacion": "Apartado 3.2"
    }
  ],
  "puntuacionCalidad": 85,
  "recomendaciones": ["rec1", "rec2"],
  "erroresCriticos": ["error1"],
  "advertencias": ["warn1", "warn2"]
}

================================================================================
                            CONFIGURACI√ìN T√âCNICA
================================================================================

CONTEXTOS RAG NECESARIOS:
- PLANTILLAS_PLIEGOS: Plantillas base de los 4 tipos
- PLANTILLAS_VARIANTES: Variantes con/sin lotes
- TAGS_SAP: Documentos con marcadores SAP
- PLIEGOS_REFERENCIA: Ejemplos hist√≥ricos correctos
- ERRORES_COMUNES: Casos de error documentados

ARCHIVOS DE SALIDA:
- ./validation_results/campos_variables_detectados.txt
- ./validation_results/reporte_validacion_[timestamp].json
- ./validation_results/errores_estructurales_[timestamp].txt

M√âTRICAS DE CALIDAD:
- Completitud estructural (0-100)
- Adherencia a plantilla (0-100)
- Calidad de lotes (0-100 si aplica)
- Consistencia hist√≥rica (0-100)
- Puntuaci√≥n global (promedio ponderado)

================================================================================
                            CASOS DE USO ESPEC√çFICOS
================================================================================

CASO 1 - PLIEGO NUEVO:
- Validar contra plantilla correspondiente
- Identificar todos los campos variables
- Generar reporte completo de validaci√≥n
- Crear baseline para futuras comparaciones

CASO 2 - PLIEGO MODIFICADO:
- Comparar con versi√≥n anterior
- Identificar cambios estructurales
- Validar que modificaciones sean apropiadas
- Alertar sobre desviaciones significativas

CASO 3 - LOTE A√ëADIDO/ELIMINADO:
- Detectar cambio en estructura de lotes
- Validar coherencia con tipo de pliego
- Verificar completitud de informaci√≥n de lotes
- Actualizar clasificaci√≥n del documento

CASO 4 - ERROR DE GENERACI√ìN SAP:
- Detectar tags no reemplazados
- Identificar campos con formato incorrecto
- Validar coherencia de datos insertados
- Sugerir correcciones espec√≠ficas

================================================================================
                            NOTAS IMPORTANTES
================================================================================

PRINCIPIOS CLAVE:
1. NO INVENTAR contenido est√°tico - debe coincidir exactamente con plantillas
2. IDENTIFICAR autom√°ticamente el tipo de pliego por patrones estructurales
3. DISTINGUIR claramente entre contenido fijo y variable
4. MANTENER historial de campos variables para mejora continua
5. PROPORCIONAR feedback espec√≠fico y accionable

LIMITACIONES:
- Requiere entrenamiento inicial con todas las plantillas
- Necesita ejemplos de cada tipo de pliego para calibraci√≥n
- Dependiente de la calidad de los documentos de referencia
- Puede requerir ajustes seg√∫n evoluci√≥n de plantillas SAP

EVOLUCI√ìN:
- Sistema debe aprender de nuevos casos
- Plantillas pueden actualizarse y requerir reentrenamiento
- Campos variables pueden cambiar seg√∫n actualizaciones SAP
- M√©tricas de calidad deben refinarse con uso

================================================================================
                                    FIN
================================================================================
