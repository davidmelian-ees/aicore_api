import axios from "axios";

const BASE_URL = "https://chromadb-server.cfapps.eu10-005.hana.ondemand.com/api/v2";
const TENANT = "demo";
const DATABASE = "demodb";

// üëâ cambia el nombre si quieres usar otro
const COLLECTION_NAME = "democollection";

// üîπ Si necesitas autenticaci√≥n, a√±ade tu token aqu√≠
const HEADERS = {
  "Content-Type": "application/json",
  // "Authorization": `Bearer ${process.env.CHROMA_TOKEN}`
};

// Crear colecci√≥n con dimensi√≥n fija
async function createCollection(name = COLLECTION_NAME, dimension = 3) {
  try {
    const res = await axios.post(
      `${BASE_URL}/tenants/${TENANT}/databases/${DATABASE}/collections`,
      { name, dimension },
      { headers: HEADERS }
    );
    console.log("‚úÖ Colecci√≥n creada:", res.data);
    return res.data;
  } catch (err) {
    console.error("‚ö†Ô∏è Error creando colecci√≥n:", err.response?.data || err.message);
  }
}

// Listar colecciones
async function listCollections() {
  try {
    const res = await axios.get(
      `${BASE_URL}/tenants/${TENANT}/databases/${DATABASE}/collections`,
      { headers: HEADERS }
    );
    console.log("üìÇ Colecciones:", res.data);
    return res.data;
  } catch (err) {
    console.error("‚ö†Ô∏è Error listando colecciones:", err.response?.data || err.message);
  }
}

// Insertar documento en una colecci√≥n
async function addDocument(collectionId, documents, ids, embeddings) {
  try {
    const body = {
      documents: documents,
      embeddings: [embeddings], // dimensi√≥n = 3
      ids: ids,
      metadatas: [{ source: "nodejs-demo" }]
    };

    const res = await axios.post(
      `${BASE_URL}/tenants/${TENANT}/databases/${DATABASE}/collections/${collectionId}/add`,
      body,
      { headers: HEADERS }
    );

    console.log("‚úÖ Documento insertado:", res.data);
    return res.data;
  } catch (err) {
    console.error("‚ö†Ô∏è Error insertando documento:", err.response?.data || err.message);
  }
}

// Exportar funciones
export { createCollection, listCollections, addDocument };