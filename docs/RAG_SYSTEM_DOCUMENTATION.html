<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema RAG - DocumentaciÃ³n Completa</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 40px; line-height: 1.6; }
        h1 { color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        h2 { color: #34495e; border-bottom: 1px solid #bdc3c7; padding-bottom: 5px; margin-top: 30px; }
        h3 { color: #7f8c8d; }
        .header { text-align: center; margin-bottom: 40px; }
        .section { margin-bottom: 30px; }
        .code { background-color: #f8f9fa; padding: 15px; border-left: 4px solid #3498db; font-family: 'Courier New', monospace; }
        .table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        .table th, .table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        .table th { background-color: #3498db; color: white; }
        .highlight { background-color: #fff3cd; padding: 10px; border-left: 4px solid #ffc107; }
        .success { background-color: #d4edda; padding: 10px; border-left: 4px solid #28a745; }
        .architecture { text-align: center; margin: 20px 0; }
        ul { margin-left: 20px; }
        li { margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="header">
    <h1>ğŸ¤– Sistema RAG con SAP AI Core y ChromaDB</h1>
    <p><strong>DocumentaciÃ³n TÃ©cnica Completa</strong></p>
    <p>VersiÃ³n 1.0.0 | Octubre 2024</p>
</div>

<div class="section">
    <h2>ğŸ“‹ Resumen Ejecutivo</h2>
    <p>El <strong>Sistema RAG (Retrieval-Augmented Generation)</strong> es una soluciÃ³n empresarial que integra <strong>SAP AI Core</strong> con <strong>ChromaDB</strong> para proporcionar capacidades avanzadas de bÃºsqueda semÃ¡ntica y chat conversacional basado en documentos corporativos.</p>
    
    <h3>ğŸ¯ CaracterÃ­sticas Principales</h3>
    <ul>
        <li>âœ… <strong>IntegraciÃ³n completa con SAP AI Core</strong> para embeddings y generaciÃ³n de texto</li>
        <li>âœ… <strong>ChromaDB embebido</strong> para persistencia vectorial en Cloud Foundry</li>
        <li>âœ… <strong>Procesamiento multi-formato</strong>: TXT, DOCX, MD, JSON, CSV</li>
        <li>âœ… <strong>API REST completa</strong> con endpoints para gestiÃ³n de documentos</li>
        <li>âœ… <strong>Chat conversacional</strong> usando contexto de documentos indexados</li>
        <li>âœ… <strong>Fallback automÃ¡tico</strong> a almacenamiento en memoria</li>
        <li>âœ… <strong>AutenticaciÃ³n XSUAA</strong> para entornos de producciÃ³n</li>
        <li>âœ… <strong>Despliegue en Cloud Foundry</strong> con configuraciÃ³n automÃ¡tica</li>
    </ul>
</div>

<div class="section">
    <h2>ğŸ—ï¸ Arquitectura del Sistema</h2>
    
    <div class="architecture">
        <div class="code">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>
â”‚                    SAP BTP Cloud Foundry                    â”‚<br>
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚<br>
â”‚  â”‚   Node.js API   â”‚    â”‚   SAP AI Core   â”‚                â”‚<br>
â”‚  â”‚   (Express)     â”‚â—„â”€â”€â–ºâ”‚   (Embeddings   â”‚                â”‚<br>
â”‚  â”‚                 â”‚    â”‚   & Chat LLM)   â”‚                â”‚<br>
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚<br>
â”‚           â”‚                                                 â”‚<br>
â”‚           â–¼                                                 â”‚<br>
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚<br>
â”‚  â”‚   ChromaDB      â”‚    â”‚   XSUAA Auth    â”‚                â”‚<br>
â”‚  â”‚   (Embebido)    â”‚    â”‚   Service       â”‚                â”‚<br>
â”‚  â”‚   Persistente   â”‚    â”‚                 â”‚                â”‚<br>
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚<br>
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </div>
    </div>

    <h3>ğŸ”„ Flujo de Datos</h3>
    <table class="table">
        <tr>
            <th>Proceso</th>
            <th>Flujo</th>
        </tr>
        <tr>
            <td><strong>Ingesta de Documentos</strong></td>
            <td>Documento â†’ Procesamiento â†’ Chunking â†’ Embeddings (SAP AI Core) â†’ ChromaDB</td>
        </tr>
        <tr>
            <td><strong>BÃºsqueda SemÃ¡ntica</strong></td>
            <td>Query â†’ Embedding (SAP AI Core) â†’ BÃºsqueda Vectorial (ChromaDB) â†’ Resultados Rankeados</td>
        </tr>
        <tr>
            <td><strong>Chat RAG</strong></td>
            <td>Pregunta â†’ BÃºsqueda Contexto â†’ Prompt + Contexto â†’ LLM (SAP AI Core) â†’ Respuesta</td>
        </tr>
    </table>
</div>

<div class="section">
    <h2>âš™ï¸ ConfiguraciÃ³n y Despliegue</h2>
    
    <h3>ğŸ”§ ConfiguraciÃ³n Local</h3>
    <div class="code">
# Instalar dependencias<br>
npm install<br><br>

# Configurar variables de entorno<br>
cp default-env.json.example default-env.json<br><br>

# Iniciar ChromaDB local<br>
cd chroma_service<br>
start_service.bat<br><br>

# Iniciar servidor<br>
npm start
    </div>

    <h3>â˜ï¸ Despliegue en Cloud Foundry</h3>
    <div class="code">
# Login en Cloud Foundry<br>
cf login -a https://api.cf.eu10.hana.ondemand.com<br><br>

# Configurar target<br>
cf target -o "ORGANIZACION" -s "ESPACIO"<br><br>

# Desplegar aplicaciÃ³n<br>
cf push<br><br>

# Verificar estado<br>
cf apps<br>
cf logs ai_core_api --recent
    </div>

    <h3>ğŸ“Š ConfiguraciÃ³n manifest.yml</h3>
    <div class="code">
---<br>
applications:<br>
  - name: ai_core_api<br>
    memory: 512M<br>
    buildpacks:<br>
      - nodejs_buildpack<br>
    command: node server.js<br>
    services:<br>
      - aicore-app-auth<br>
    env:<br>
      VECTOR_STORE_TYPE: chroma<br>
      NODE_ENV: production
    </div>
</div>

<div class="section">
    <h2>ğŸ“¡ API Reference</h2>
    
    <h3>ğŸ¥ Health Checks</h3>
    <table class="table">
        <tr>
            <th>Endpoint</th>
            <th>MÃ©todo</th>
            <th>DescripciÃ³n</th>
        </tr>
        <tr>
            <td>/health</td>
            <td>GET</td>
            <td>Estado general de la aplicaciÃ³n</td>
        </tr>
        <tr>
            <td>/api/rag/health</td>
            <td>GET</td>
            <td>Estado especÃ­fico del sistema RAG</td>
        </tr>
        <tr>
            <td>/api/rag/stats</td>
            <td>GET</td>
            <td>EstadÃ­sticas detalladas del sistema</td>
        </tr>
    </table>

    <h3>ğŸ“„ GestiÃ³n de Documentos</h3>
    <table class="table">
        <tr>
            <th>Endpoint</th>
            <th>MÃ©todo</th>
            <th>DescripciÃ³n</th>
        </tr>
        <tr>
            <td>/api/rag/documents</td>
            <td>GET</td>
            <td>Listar todos los documentos indexados</td>
        </tr>
        <tr>
            <td>/api/rag/upload</td>
            <td>POST</td>
            <td>Subir y procesar un documento</td>
        </tr>
        <tr>
            <td>/api/rag/documents/{id}</td>
            <td>DELETE</td>
            <td>Eliminar documento especÃ­fico</td>
        </tr>
    </table>

    <h3>ğŸ” BÃºsqueda y Chat</h3>
    <table class="table">
        <tr>
            <th>Endpoint</th>
            <th>MÃ©todo</th>
            <th>DescripciÃ³n</th>
        </tr>
        <tr>
            <td>/api/rag/search</td>
            <td>POST</td>
            <td>BÃºsqueda semÃ¡ntica en documentos</td>
        </tr>
        <tr>
            <td>/api/rag/chat</td>
            <td>POST</td>
            <td>Chat conversacional con contexto RAG</td>
        </tr>
    </table>
</div>

<div class="section">
    <h2>ğŸ“– Ejemplos de Uso</h2>
    
    <h3>ğŸ” BÃºsqueda SemÃ¡ntica</h3>
    <div class="code">
curl -X POST https://tu-app.cfapps.sap.hana.ondemand.com/api/rag/search \<br>
  -H "Content-Type: application/json" \<br>
  -d '{<br>
    "query": "polÃ­ticas de vacaciones",<br>
    "topK": 5,<br>
    "minSimilarity": 0.3<br>
  }'
    </div>

    <h3>ğŸ’¬ Chat RAG</h3>
    <div class="code">
curl -X POST https://tu-app.cfapps.sap.hana.ondemand.com/api/rag/chat \<br>
  -H "Content-Type: application/json" \<br>
  -d '{<br>
    "message": "Â¿CuÃ¡les son las polÃ­ticas de vacaciones?",<br>
    "maxTokens": 500,<br>
    "temperature": 0.7<br>
  }'
    </div>

    <h3>ğŸ“„ Subir Documento</h3>
    <div class="code">
curl -X POST https://tu-app.cfapps.sap.hana.ondemand.com/api/rag/upload \<br>
  -F "document=@documento.pdf" \<br>
  -F "tags=politicas,empresa" \<br>
  -F "description=PolÃ­ticas corporativas"
    </div>
</div>

<div class="section">
    <h2>ğŸ§ª Testing y ValidaciÃ³n</h2>
    
    <h3>ğŸ“‹ Estructura de Tests</h3>
    <ul>
        <li><strong>tests/test_python_chroma.js</strong> - Test integraciÃ³n ChromaDB</li>
        <li><strong>tests/test_rag.js</strong> - Test sistema RAG completo</li>
        <li><strong>tests/test_service.js</strong> - Test servicios individuales</li>
        <li><strong>postman/RAG_API_Postman_Collection.json</strong> - ColecciÃ³n Postman completa</li>
    </ul>

    <h3>ğŸš€ Ejecutar Tests</h3>
    <div class="code">
# Test completo del sistema<br>
node tests/test_python_chroma.js<br><br>

# Test especÃ­fico RAG<br>
node tests/test_rag.js<br><br>

# Importar colecciÃ³n Postman<br>
# File â†’ Import â†’ postman/RAG_API_Postman_Collection.json
    </div>
</div>

<div class="section">
    <h2>ğŸ“Š Monitoreo y Mantenimiento</h2>
    
    <h3>ğŸ“ˆ MÃ©tricas de Performance</h3>
    <table class="table">
        <tr>
            <th>OperaciÃ³n</th>
            <th>Tiempo Esperado</th>
            <th>Uso de Memoria</th>
        </tr>
        <tr>
            <td>Health Check</td>
            <td>&lt; 100ms</td>
            <td>MÃ­nimo</td>
        </tr>
        <tr>
            <td>BÃºsqueda semÃ¡ntica</td>
            <td>200-500ms</td>
            <td>Moderado</td>
        </tr>
        <tr>
            <td>Chat RAG</td>
            <td>1-3 segundos</td>
            <td>Alto</td>
        </tr>
        <tr>
            <td>Upload documento</td>
            <td>2-10 segundos</td>
            <td>Variable</td>
        </tr>
    </table>

    <h3>ğŸ”§ Comandos de Monitoreo</h3>
    <div class="code">
# Ver estado de la aplicaciÃ³n<br>
cf app ai_core_api<br><br>

# Ver logs en tiempo real<br>
cf logs ai_core_api<br><br>

# Escalar aplicaciÃ³n<br>
cf scale ai_core_api -i 2 -m 1G<br><br>

# Health check automÃ¡tico<br>
curl https://tu-app.cfapps.sap.hana.ondemand.com/health
    </div>
</div>

<div class="section">
    <h2>ğŸš¨ Troubleshooting</h2>
    
    <h3>âŒ Problemas Comunes</h3>
    <table class="table">
        <tr>
            <th>Error</th>
            <th>Causa</th>
            <th>SoluciÃ³n</th>
        </tr>
        <tr>
            <td>ChromaDB no disponible</td>
            <td>Servicio no inicializado</td>
            <td>Verificar VECTOR_STORE_TYPE, reiniciar servicio</td>
        </tr>
        <tr>
            <td>SAP AI Core no responde</td>
            <td>Credenciales incorrectas</td>
            <td>Verificar default-env.json, servicios bindeados</td>
        </tr>
        <tr>
            <td>Memory limit exceeded</td>
            <td>Insuficiente RAM</td>
            <td>Aumentar memoria: cf scale ai_core_api -m 1G</td>
        </tr>
        <tr>
            <td>No documents found</td>
            <td>Documentos no cargados</td>
            <td>Verificar inicializaciÃ³n, re-ejecutar ingesta</td>
        </tr>
    </table>

    <div class="highlight">
        <strong>ğŸ’¡ Tip:</strong> Para diagnÃ³stico completo, ejecutar: <code>node tests/test_python_chroma.js</code>
    </div>
</div>

<div class="section">
    <h2>ğŸ“ Estructura del Proyecto</h2>
    
    <div class="code">
aicore_api/<br>
â”œâ”€â”€ ğŸ“ auth/                    # AutenticaciÃ³n SAP<br>
â”œâ”€â”€ ğŸ“ chroma_service/          # ChromaDB local<br>
â”œâ”€â”€ ğŸ“ docs/                    # ğŸ“š DocumentaciÃ³n<br>
â”œâ”€â”€ ğŸ“ postman/                 # ğŸ“® Colecciones API<br>
â”œâ”€â”€ ğŸ“ routes/                  # Rutas Express<br>
â”œâ”€â”€ ğŸ“ sample_documents/        # Docs de ejemplo<br>
â”œâ”€â”€ ğŸ“ scripts/                 # ğŸ› ï¸ Scripts utilidades<br>
â”œâ”€â”€ ğŸ“ services/                # Servicios core<br>
â”œâ”€â”€ ğŸ“ tests/                   # ğŸ§ª Testing completo<br>
â”œâ”€â”€ server.js                   # Servidor principal<br>
â”œâ”€â”€ manifest.yml               # Config Cloud Foundry<br>
â””â”€â”€ package.json               # Dependencias
    </div>
</div>

<div class="section success">
    <h2>âœ… Estado del Proyecto</h2>
    <p><strong>Sistema completamente funcional y desplegado en Cloud Foundry</strong></p>
    <ul>
        <li>âœ… IntegraciÃ³n SAP AI Core operativa</li>
        <li>âœ… ChromaDB con persistencia completa</li>
        <li>âœ… API REST documentada y testeada</li>
        <li>âœ… Chat RAG funcionando</li>
        <li>âœ… AutenticaciÃ³n XSUAA habilitada</li>
        <li>âœ… Monitoreo y logs configurados</li>
    </ul>
</div>

<div class="section">
    <h2>ğŸ“ Contacto y Soporte</h2>
    <p><strong>Equipo de Desarrollo:</strong> [equipo@empresa.com]</p>
    <p><strong>DocumentaciÃ³n:</strong> /docs/</p>
    <p><strong>Testing:</strong> /postman/ y /tests/</p>
    <p><strong>VersiÃ³n:</strong> 1.0.0 | <strong>Fecha:</strong> Octubre 2024</p>
</div>

</body>
</html>
