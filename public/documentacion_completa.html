<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentaci√≥n Completa - Sistema RAG con SAP AI Core - David Meli√°n</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 0;
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 3em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        nav {
            background: #343a40;
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        nav ul {
            list-style: none;
            text-align: center;
        }
        
        nav li {
            display: inline;
            margin: 0 15px;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            padding: 10px 15px;
            border-radius: 5px;
            transition: background 0.3s;
        }
        
        nav a:hover {
            background: #495057;
        }
        
        section {
            background: white;
            margin: 20px 0;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h2 {
            color: #495057;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 2.2em;
        }
        
        h3 {
            color: #6c757d;
            margin: 25px 0 15px 0;
            font-size: 1.6em;
        }
        
        h4 {
            color: #6c757d;
            margin: 20px 0 10px 0;
            font-size: 1.3em;
        }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
        
        .highlight {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
        }
        
        .warning {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 15px;
            margin: 15px 0;
        }
        
        .success {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 15px 0;
        }
        
        .list-item {
            margin: 10px 0;
            padding-left: 20px;
            position: relative;
        }
        
        .list-item::before {
            content: "‚úì";
            color: #28a745;
            font-weight: bold;
            position: absolute;
            left: 0;
        }
        
        .endpoint {
            background: #e9ecef;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
        }
        
        .method {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            color: white;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .get { background: #28a745; }
        .post { background: #007bff; }
        .delete { background: #dc3545; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        
        th {
            background: #f8f9fa;
            font-weight: bold;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .badge.primary { background: #007bff; color: white; }
        .badge.success { background: #28a745; color: white; }
        .badge.warning { background: #ffc107; color: black; }
        .badge.danger { background: #dc3545; color: white; }
        
        footer {
            text-align: center;
            padding: 20px;
            background: #343a40;
            color: white;
            margin-top: 40px;
        }
        
        .toc {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        
        .toc ul {
            list-style: none;
        }
        
        .toc li {
            margin: 5px 0;
        }
        
        .toc a {
            color: #007bff;
            text-decoration: none;
        }
        
        .toc a:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            nav li {
                display: block;
                margin: 5px 0;
            }
            
            section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>üìö Sistema RAG con SAP AI Core/Revisi√≥n de pliegos</h1>
            <p class="subtitle">Documentaci√≥n Completa del Sistema de Recuperaci√≥n Aumentada por Generaci√≥n</p>
            <p><strong>Versi√≥n:</strong> 1.1.0 | <strong>Fecha:</strong> Noviembre 2025 | <strong>Proyecto:</strong> AI Core API | <strong>Creada por:</strong> David Meli√°n</p>
        </div>
    </header>

    <nav>
        <div class="container">
            <ul>
                <li><a href="#introduccion">Introducci√≥n</a></li>
                <li><a href="#arquitectura">Arquitectura</a></li>
                <li><a href="#instalacion">Instalaci√≥n</a></li>
                <li><a href="#api">API Reference</a></li>
                <li><a href="#funcionalidades">Funcionalidades</a></li>
                <li><a href="#backup-restore">Backup y Restore</a></li>
                <li><a href="#logs">Sistema de Logs</a></li>
                <li><a href="#guias">Gu√≠as de Uso</a></li>
                <li><a href="#troubleshooting">Troubleshooting</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <section id="introduccion">
            <h2>üéØ Resumen</h2>
            
            <h3>Descripci√≥n del Proyecto</h3>
            <p>El <strong>Sistema RAG (Retrieval-Augmented Generation)</strong> es una soluci√≥n completa que integra <strong>SAP AI Core</strong> con <strong>ChromaDB</strong> para proporcionar capacidades avanzadas de b√∫squeda sem√°ntica y chat conversacional basado en documentos corporativos.</p>
            
            <h3>Caracter√≠sticas Principales</h3>
            <div class="list-item">‚úÖ <strong>Integraci√≥n completa con SAP AI Core</strong> para embeddings y generaci√≥n de texto</div>
            <div class="list-item">‚úÖ <strong>ChromaDB embebido</strong> para persistencia vectorial en Cloud Foundry</div>
            <div class="list-item">‚úÖ <strong>Procesamiento multi-formato</strong>: TXT, DOCX, MD, JSON, CSV, PDF, XLSX, XLS</div>
            <div class="list-item">‚úÖ <strong>API REST completa</strong> con endpoints para gesti√≥n de documentos</div>
            <div class="list-item">‚úÖ <strong>Chat conversacional</strong> usando contexto de documentos indexados</div>
            <div class="list-item">‚úÖ <strong>Fallback autom√°tico</strong> a almacenamiento en memoria</div>
            <div class="list-item">‚úÖ <strong>Autenticaci√≥n XSUAA</strong> para entornos de producci√≥n</div>
            <div class="list-item">‚úÖ <strong>Despliegue en Cloud Foundry</strong> con configuraci√≥n autom√°tica</div>
            
            <h3>Beneficios del Negocio</h3>
            <div class="list-item">üìà <strong>Acceso Inteligente a Informaci√≥n</strong>: B√∫squeda sem√°ntica en documentos corporativos</div>
            <div class="list-item">ü§ñ <strong>Automatizaci√≥n de Consultas</strong>: Chat bot que responde bas√°ndose en documentaci√≥n oficial</div>
            <div class="list-item">‚òÅÔ∏è <strong>Escalabilidad</strong>: Arquitectura cloud-native en SAP BTP</div>
            <div class="list-item">üîí <strong>Seguridad</strong>: Integraci√≥n con XSUAA para control de acceso</div>
            <div class="list-item">üõ†Ô∏è <strong>Mantenimiento Simplificado</strong>: Configuraci√≥n autom√°tica y fallbacks</div>
            
            <h3>Componentes del Sistema</h3>
            <table>
                <thead>
                    <tr>
                        <th>Componente</th>
                        <th>Prop√≥sito</th>
                        <th>Tecnolog√≠as</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Backend API</strong></td>
                        <td>Servidor principal con l√≥gica de negocio</td>
                        <td>Node.js, Express.js, ES6 Modules</td>
                    </tr>
                    <tr>
                        <td><strong>Sistema RAG</strong></td>
                        <td>B√∫squeda sem√°ntica y chat conversacional</td>
                        <td>SAP AI Core, ChromaDB, Embeddings</td>
                    </tr>
                    <tr>
                        <td><strong>Correcci√≥n PDFs</strong></td>
                        <td>Correcci√≥n ortogr√°fica autom√°tica de documentos</td>
                        <td>pdf-lib, pdfjs-dist, SAP AI Core</td>
                    </tr>
                    <tr>
                        <td><strong>Validaci√≥n Pliegos</strong></td>
                        <td>An√°lisis estructural de documentos SAP</td>
                        <td>IA generativa, Patrones de validaci√≥n</td>
                    </tr>
                    <tr>
                        <td><strong>Frontend React</strong></td>
                        <td>Interfaz de usuario para gesti√≥n del sistema</td>
                        <td>React, Axios, OAuth2</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section id="arquitectura">
            <h2>üèóÔ∏è Arquitectura del Sistema</h2>
            
            <h3>Arquitectura General</h3>
            <div style="text-align: center; margin: 20px 0;">
                <img src="../Images/diagrama.png" alt="Diagrama de Arquitectura del Sistema RAG" style="max-width: 100%; height: auto; border: 1px solid #dee2e6; border-radius: 5px;">
                <p style="margin-top: 10px; font-size: 0.9em; color: #6c757d;"><em>Diagrama general de la arquitectura del sistema</em></p>
            </div>
            
            <h3>Flujo de Datos</h3>
            <h4>1. Ingesta de Documentos</h4>
            <div class="code-block">
Documento ‚Üí Procesamiento ‚Üí Chunking ‚Üí Embeddings (SAP AI Core) ‚Üí ChromaDB/SQLite
            </div>
            
            <h4>2. B√∫squeda Sem√°ntica</h4>
            <div class="code-block">
Query ‚Üí Embedding (SAP AI Core) ‚Üí B√∫squeda Vectorial (ChromaDB/SQLite) ‚Üí Resultados Rankeados
            </div>
            
            <h4>3. Chat RAG</h4>
            <div class="code-block">
Pregunta ‚Üí B√∫squeda Contexto ‚Üí Prompt + Contexto ‚Üí LLM (SAP AI Core) ‚Üí Respuesta
            </div>
            
            <h3>Estructura de Archivos del Backend</h3>
            
            <div style="text-align: center; margin: 20px 0;">
                <img src="../Images/jerarquia_carpetas.png" alt="Jerarqu√≠a de Carpetas del Backend" style="max-width: 100%; height: auto; border: 1px solid #dee2e6; border-radius: 5px;">
                <p style="margin-top: 10px; font-size: 0.9em; color: #6c757d;"><em>Jerarqu√≠a visual de las carpetas del backend</em></p>
            </div>
            
            <h3>Componentes por Entorno</h3>
            <table>
                <thead>
                    <tr>
                        <th>Componente</th>
                        <th>Desarrollo Local</th>
                        <th>Cloud Foundry</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Vector Store</strong></td>
                        <td>ChromaDB Python Service</td>
                        <td>ChromaDB Embebido</td>
                    </tr>
                    <tr>
                        <td><strong>Autenticaci√≥n</strong></td>
                        <td>Deshabilitada</td>
                        <td>XSUAA</td>
                    </tr>
                    <tr>
                        <td><strong>Puerto</strong></td>
                        <td>4000 + 8001</td>
                        <td>Din√°mico</td>
                    </tr>
                    <tr>
                        <td><strong>Persistencia</strong></td>
                        <td>Archivos externos</td>
                        <td>Archivos locales CF</td>
                    </tr>
                    <tr>
                        <td><strong>Datos</strong></td>
                        <td>Upload manual</td>
                        <td>Pre-cargados</td>
                    </tr>
                </tbody>
            </table>
            
            <h3>Dependencias Principales</h3>
            <div class="code-block">
{
  "express": "^4.18.2",
  "multer": "^1.4.5-lts.1",
  "better-sqlite3": "^8.7.0",
  "mammoth": "^1.6.0",
  "xlsx": "^0.18.5",
  "pdfjs-dist": "^4.0.379",
  "pdf-lib": "^1.17.1",
  "@sap/xssec": "^3.2.13",
  "passport": "^0.6.0",
  "cors": "^2.8.5",
  "uuid": "^9.0.0"
}
            </div>
        </section>

        <section id="instalacion">
            <h2>‚öôÔ∏è Instalaci√≥n y Configuraci√≥n</h2>
            
            <h3>Prerequisitos</h3>
            <div class="list-item">‚úÖ <strong>Node.js 20.x</strong> o superior</div>
            <div class="list-item">‚úÖ <strong>Python 3.8+</strong> (para ChromaDB local)</div>
            <div class="list-item">‚úÖ <strong>SAP BTP Account</strong> con AI Core habilitado</div>
            <div class="list-item">‚úÖ <strong>CF CLI</strong> instalado (para despliegue)</div>
            
            <h3>Instalaci√≥n Local</h3>
            <div class="code-block">
# 1. Clonar repositorio
git clone [repository-url]
cd aicore_api

# 2. Instalar dependencias
npm install

# 3. Configurar variables de entorno
cp default-env.json.example default-env.json
# Editar con credenciales SAP BTP

# 4. Iniciar ChromaDB local (opcional)
cd chroma_service
start_service.bat

# 5. En otra terminal, iniciar servidor
npm start
            </div>
            
            <h3>Variables de Entorno</h3>
            <table>
                <thead>
                    <tr>
                        <th>Variable</th>
                        <th>Desarrollo</th>
                        <th>Producci√≥n</th>
                        <th>Descripci√≥n</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>NODE_ENV</strong></td>
                        <td>development</td>
                        <td>production</td>
                        <td>Entorno de ejecuci√≥n</td>
                    </tr>
                    <tr>
                        <td><strong>VECTOR_STORE_TYPE</strong></td>
                        <td>python</td>
                        <td>chroma</td>
                        <td>Tipo de almac√©n vectorial</td>
                    </tr>
                    <tr>
                        <td><strong>PORT</strong></td>
                        <td>4000</td>
                        <td>CF_PORT</td>
                        <td>Puerto del servidor</td>
                    </tr>
                    <tr>
                        <td><strong>RAG_CHUNK_SIZE</strong></td>
                        <td>1000</td>
                        <td>1000</td>
                        <td>Tama√±o de chunks</td>
                    </tr>
                    <tr>
                        <td><strong>RAG_CHUNK_OVERLAP</strong></td>
                        <td>200</td>
                        <td>200</td>
                        <td>Solapamiento de chunks</td>
                    </tr>
                </tbody>
            </table>
            
            <h3>Configuraci√≥n SAP AI Core</h3>
            <div class="code-block">
// auth/aiCoreClient.js
const AICORE_CONFIG = {
  authUrl: process.env.AICORE_AUTH_URL,
  clientId: process.env.AICORE_CLIENT_ID,
  clientSecret: process.env.AICORE_CLIENT_SECRET,
  resourceGroup: process.env.AICORE_RESOURCE_GROUP,
  baseUrl: process.env.AICORE_BASE_URL
};
            </div>
            
            <h3>Despliegue en Cloud Foundry</h3>
            <h4>Configuraci√≥n manifest.yml</h4>
            <div class="code-block">
---
applications:
  - name: ai_core_api
    memory: 2048M
    instances: 1
    buildpacks:
      - nodejs_buildpack
    command: node server.js
    services:
      - aicore-app-auth
    env:
      NODE_ENV: production
      VECTOR_STORE_TYPE: sqlite
            </div>
            
            <h4>Proceso de Despliegue</h4>
            <div class="code-block">
# 1. Login en Cloud Foundry
cf login -a https://api.cf.eu10-005.hana.ondemand.com

# 2. Configurar target
cf target -o "ORGANIZACION" -s "ESPACIO"

# 3. Desplegar aplicaci√≥n
cf push

# 4. Verificar estado
cf apps
cf logs ai_core_api --recent
            </div>
            
            <h3>Scripts de Automatizaci√≥n</h3>
            <table>
                <thead>
                    <tr>
                        <th>Script</th>
                        <th>Prop√≥sito</th>
                        <th>Ubicaci√≥n</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>start-local-development.bat</strong></td>
                        <td>Iniciar desarrollo completo</td>
                        <td>Ra√≠z del proyecto</td>
                    </tr>
                    <tr>
                        <td><strong>deploy-backend.bat</strong></td>
                        <td>Desplegar backend a CF</td>
                        <td>Ra√≠z del proyecto</td>
                    </tr>
                    <tr>
                        <td><strong>cleanup-project.bat</strong></td>
                        <td>Limpiar archivos temporales</td>
                        <td>Backend</td>
                    </tr>
                    <tr>
                        <td><strong>start-with-sqlite.bat</strong></td>
                        <td>Iniciar con SQLite</td>
                        <td>Backend</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section id="api">
            <h2>üì° API Reference</h2>
            
            <h3>Base URLs</h3>
            <div class="list-item">üåê <strong>Desarrollo</strong>: http://localhost:4000</div>
            <div class="list-item">‚òÅÔ∏è <strong>Producci√≥n</strong>: https://tu-app.cfapps.sap.hana.ondemand.com</div>
            
            <h3>Endpoints de Salud</h3>
            <div class="endpoint">
                <span class="method get">GET</span> /health
            </div>
            <div class="code-block">
{
  "status": "healthy",
  "timestamp": "2024-10-08T12:30:00Z",
  "environment": "production",
  "vectorStore": "chroma"
}
            </div>
            
            <div class="endpoint">
                <span class="method get">GET</span> /api/rag/health
            </div>
            <div class="code-block">
{
  "status": "healthy",
  "message": "Sistema RAG funcionando correctamente",
  "summary": {
    "totalDocuments": 2,
    "totalChunks": 15,
    "embeddingDimension": 384,
    "vectorStoreType": "chroma"
  }
}
            </div>
            
            <h3>Gesti√≥n de Documentos</h3>
            <div class="endpoint">
                <span class="method get">GET</span> /api/rag/documents
            </div>
            <p>Lista todos los documentos indexados con metadatos</p>
            
            <div class="endpoint">
                <span class="method post">POST</span> /api/rag/upload
            </div>
            <p>Sube y procesa un documento</p>
            <div class="code-block">
Content-Type: multipart/form-data
Campos: document (file), tags (string), description (string)
            </div>
            
            <div class="endpoint">
                <span class="method delete">DELETE</span> /api/rag/documents/{documentId}
            </div>
            <p>Elimina un documento espec√≠fico del √≠ndice</p>
            
            <h3>B√∫squeda y Chat</h3>
            <div class="endpoint">
                <span class="method post">POST</span> /api/rag/search
            </div>
            <div class="code-block">
{
  "query": "pol√≠ticas de vacaciones",
  "topK": 5,
  "minSimilarity": 0.3,
  "documentId": "opcional"
}
            </div>
            
            <div class="endpoint">
                <span class="method post">POST</span> /api/rag/chat
            </div>
            <div class="code-block">
{
  "message": "¬øCu√°les son las pol√≠ticas de vacaciones?",
  "maxTokens": 500,
  "temperature": 0.7
}
            </div>
            
            <h3>Backup y Restauraci√≥n</h3>
            <div class="endpoint">
                <span class="method get">GET</span> /api/rag/download-db
            </div>
            <p>Descarga backup de base de datos SQLite</p>
            
            <div class="endpoint">
                <span class="method post">POST</span> /api/rag/upload-db
            </div>
            <p>Sube/restaura base de datos desde backup</p>
            
            <h3>Correcci√≥n de PDFs</h3>
            <div class="endpoint">
                <span class="method post">POST</span> /api/pdf-correction/generate-list
            </div>
            <p>Genera PDF con lista de correcciones al final</p>
            
            <div class="endpoint">
                <span class="method post">POST</span> /api/pdf-correction/apply-corrections
            </div>
            <p>Aplica correcciones directamente al PDF preservando formato</p>
            
            <h3>Validaci√≥n de Pliegos</h3>
            <div class="endpoint">
                <span class="method post">POST</span> /api/pliego-validation/validate
            </div>
            <p>Valida pliego y genera informe de errores</p>
            
            <div class="endpoint">
                <span class="method post">POST</span> /api/pliego-validation/validate-text
            </div>
            <p>Valida texto directo de pliego</p>
            
            <h3>Gesti√≥n de Contextos</h3>
            <div class="endpoint">
                <span class="method get">GET</span> /api/rag/contexts
            </div>
            <p>Lista todos los contextos disponibles</p>
            
            <div class="endpoint">
                <span class="method post">POST</span> /api/rag/contexts
            </div>
            <div class="code-block">
{
  "name": "Documentos RRHH",
  "description": "Pol√≠ticas y procedimientos de recursos humanos"
}
            </div>
            
            <div class="endpoint">
                <span class="method delete">DELETE</span> /api/rag/contexts/{contextId}
            </div>
            <p>Elimina un contexto y todos sus documentos</p>
            
            <h3>Gesti√≥n de Errores de Pliegos</h3>
            <div class="endpoint">
                <span class="method get">GET</span> /api/pdf-correction/errors/raw
            </div>
            <p>Obtiene el JSON completo de errores de todos los pliegos</p>
            <div class="code-block">
{
  "success": true,
  "database": {
    "pliegos": [
      {
        "metadata": {
          "pliegoId": "PLIEGO_123",
          "fileName": "pliego.pdf",
          "analyzedAt": "2025-11-17T09:35:36.804Z"
        },
        "criticalErrors": [...],
        "warnings": [...],
        "summary": {
          "totalCriticalErrors": 4,
          "totalWarnings": 5
        }
      }
    ]
  },
  "totalPliegos": 2
}
            </div>
            
            <div class="endpoint">
                <span class="method get">GET</span> /api/pdf-correction/errors/download
            </div>
            <p>Descarga el JSON de errores como archivo</p>
            
            <div class="endpoint">
                <span class="method get">GET</span> /api/pdf-correction/errors/statistics
            </div>
            <p>Obtiene estad√≠sticas agregadas de todos los errores</p>
            <div class="code-block">
{
  "success": true,
  "statistics": {
    "totalPliegos": 2,
    "totalCriticalErrors": 4,
    "totalWarnings": 5,
    "errorsByType": {
      "ERROR_NUMERICO": 2,
      "COMENTARIO_DESARROLLADOR": 4,
      "TAG_SIN_REEMPLAZAR": 1
    }
  }
}
            </div>
            
            <div class="endpoint">
                <span class="method get">GET</span> /api/pdf-correction/errors/by-date
            </div>
            <p>Filtra errores por rango de fechas</p>
            <div class="code-block">
Query params:
  - dateIni: YYYY-MM-DD (fecha inicial)
  - dateFin: YYYY-MM-DD (fecha final)

Ejemplo: /api/pdf-correction/errors/by-date?dateIni=2025-11-01&dateFin=2025-11-17
            </div>
            
            <div class="endpoint">
                <span class="method get">GET</span> /api/pdf-correction/errors/by-date/{date}
            </div>
            <p>Obtiene errores de una fecha espec√≠fica</p>
            
            <div class="endpoint">
                <span class="method get">GET</span> /api/pdf-correction/errors/grouped-by-date
            </div>
            <p>Agrupa errores por fecha de an√°lisis</p>
            <div class="code-block">
Query params:
  - dateIni: YYYY-MM-DD (opcional)
  - dateFin: YYYY-MM-DD (opcional)

Respuesta:
{
  "success": true,
  "data": {
    "2025-11-17": {
      "pliegos": [...],
      "totalCriticalErrors": 4,
      "totalWarnings": 5
    }
  }
}
            </div>
            
            <div class="endpoint">
                <span class="method get">GET</span> /api/pdf-correction/errors/by-type/{errorType}
            </div>
            <p>Filtra errores por tipo espec√≠fico</p>
            <div class="code-block">
Ejemplo: /api/pdf-correction/errors/by-type/ERROR_NUMERICO

Tipos disponibles:
  - ERROR_NUMERICO
  - TAG_SIN_REEMPLAZAR
  - COMENTARIO_DESARROLLADOR
  - FORMATO_FECHA_ERRONEO
  - CAMPO_SI_NO_DUPLICADO
  - etc.
            </div>
        </section>

        <section id="funcionalidades">
            <h2>üîß Funcionalidades Principales</h2>
            
            <h3>1. Sistema RAG (Retrieval-Augmented Generation)</h3>
            <div class="list-item">üîç <strong>B√∫squeda Sem√°ntica</strong>: Encuentra informaci√≥n relevante usando similitud de vectores</div>
            <div class="list-item">üí¨ <strong>Chat Conversacional</strong>: Responde preguntas bas√°ndose en documentos indexados</div>
            <div class="list-item">üìö <strong>Procesamiento Multi-formato</strong>: Soporte para TXT, DOCX, MD, JSON, CSV, PDF, XLSX, XLS</div>
            <div class="list-item">üéØ <strong>Chunking Inteligente</strong>: Divide documentos en fragmentos con solapamiento</div>
            <div class="list-item">üß† <strong>Embeddings SAP AI Core</strong>: Generaci√≥n de vectores usando modelos de SAP</div>
            <div class="list-item">üíæ <strong>Persistencia Vectorial</strong>: ChromaDB embebido o SQLite como fallback</div>
            
            <h3>2. Correcci√≥n Ortogr√°fica de PDFs</h3>
            <div class="list-item">üìÑ <strong>Dos Enfoques</strong>: Lista de correcciones o aplicaci√≥n directa</div>
            <div class="list-item">üé® <strong>Preservaci√≥n de Formato</strong>: Mantiene fuentes, colores y posiciones</div>
            <div class="list-item">ü§ñ <strong>IA Autom√°tica</strong>: Detecta errores usando SAP AI Core</div>
            <div class="list-item">üîß <strong>Correcciones Manuales</strong>: Aplica cambios espec√≠ficos</div>
            <div class="list-item">üñ•Ô∏è <strong>Interfaz Web</strong>: Herramienta de prueba en /public/pdf-correction-test.html</div>
            
            <h3>3. Validaci√≥n Estructural de Pliegos SAP</h3>
            <div class="list-item">üèóÔ∏è <strong>4 Tipos de Pliegos</strong>: Obra civil y edificaci√≥n, abierto y simplificado</div>
            <div class="list-item">üìã <strong>Detecci√≥n Autom√°tica</strong>: Identifica tipo y modalidad por nomenclatura</div>
            <div class="list-item">üö® <strong>Errores Cr√≠ticos</strong>: Tags SAP sin reemplazar, estructuras incorrectas</div>
            <div class="list-item">‚ö†Ô∏è <strong>Advertencias</strong>: Problemas que permiten continuar</div>
            <div class="list-item">‚úÖ <strong>Sugerencias</strong>: Recomendaciones de mejora espec√≠ficas</div>
            <div class="list-item">üìä <strong>Puntuaci√≥n de Calidad</strong>: Evaluaci√≥n 0-100 de la estructura</div>
            
            <h3>4. Gesti√≥n de Contextos RAG</h3>
            <div class="list-item">üìÅ <strong>Organizaci√≥n L√≥gica</strong>: Agrupa documentos por tema o departamento</div>
            <div class="list-item">üéØ <strong>B√∫squeda Filtrada</strong>: Limita consultas a contextos espec√≠ficos</div>
            <div class="list-item">üìà <strong>Estad√≠sticas</strong>: Conteo de documentos por contexto</div>
            <div class="list-item">üîÑ <strong>Persistencia JSON</strong>: Contextos guardados en data/contexts.json</div>
            
            <h3>5. Sistema de Backup y Restauraci√≥n</h3>
            <div class="list-item">üíæ <strong>Backup Autom√°tico</strong>: Descarga de base de datos SQLite</div>
            <div class="list-item">üîÑ <strong>Restauraci√≥n</strong>: Subida y validaci√≥n de backups</div>
            <div class="list-item">üìä <strong>Informaci√≥n de BD</strong>: Estad√≠sticas y estado de la base de datos</div>
            <div class="list-item">üõ°Ô∏è <strong>Scripts Automatizados</strong>: Gesti√≥n programada de backups</div>
            
            <h3>6. Autenticaci√≥n y Seguridad</h3>
            <div class="list-item">üîê <strong>XSUAA</strong>: Autenticaci√≥n OAuth2 en producci√≥n</div>
            <div class="list-item">üö´ <strong>Deshabilitada en Desarrollo</strong>: Simplificaci√≥n para testing</div>
            <div class="list-item">üõ°Ô∏è <strong>Middleware de Autenticaci√≥n</strong>: Protecci√≥n de rutas sensibles</div>
            <div class="list-item">üîë <strong>Tokens JWT</strong>: Gesti√≥n de sesiones seguras</div>
            
            <h3>7. Procesamiento de Documentos</h3>
            <table>
                <thead>
                    <tr>
                        <th>Formato</th>
                        <th>Librer√≠a</th>
                        <th>Caracter√≠sticas</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>TXT</strong></td>
                        <td>fs (Node.js)</td>
                        <td>Texto plano, encoding UTF-8</td>
                    </tr>
                    <tr>
                        <td><strong>MD</strong></td>
                        <td>fs (Node.js)</td>
                        <td>Markdown con conversi√≥n a texto</td>
                    </tr>
                    <tr>
                        <td><strong>JSON</strong></td>
                        <td>JSON.parse</td>
                        <td>Estructuras de datos, conversi√≥n a texto</td>
                    </tr>
                    <tr>
                        <td><strong>CSV</strong></td>
                        <td>csv-parser</td>
                        <td>Archivos tabulares, conversi√≥n a texto</td>
                    </tr>
                    <tr>
                        <td><strong>DOCX</strong></td>
                        <td>mammoth</td>
                        <td>Documentos Word, extracci√≥n de texto</td>
                    </tr>
                    <tr>
                        <td><strong>PDF</strong></td>
                        <td>pdfjs-dist</td>
                        <td>Documentos PDF, extracci√≥n de texto</td>
                    </tr>
                    <tr>
                        <td><strong>XLSX/XLS</strong></td>
                        <td>xlsx</td>
                        <td>Hojas de c√°lculo, conversi√≥n a texto</td>
                    </tr>
                </tbody>
            </table>
            
            <h3>8. Nomenclatura de Pliegos</h3>
            <div class="highlight">
                <strong>Formato Est√°ndar:</strong> {ID_PLIEGO}_plec_{TIPO}_{MODALIDAD}[_{CATEGORIA}]
            </div>
            
            <h4>Componentes:</h4>
            <div class="list-item">üÜî <strong>ID_PLIEGO</strong>: CT####### (ej: CT1078146)</div>
            <div class="list-item">üèóÔ∏è <strong>TIPO</strong>: edificacio_obert, edificacio_simplificat, obra_civil_obert, obra_civil_simplificat</div>
            <div class="list-item">üìã <strong>MODALIDAD</strong>: amb_lots, sense_lots</div>
            <div class="list-item">üìÇ <strong>CATEGORIA</strong>: vac√≠o (terminado), validacion, validate</div>
            
            <h4>Contextos RAG por Categor√≠a:</h4>
            <div class="list-item">üìù <strong>PLANTILLAS_BASE</strong>: Plantillas limpias para referencia</div>
            <div class="list-item">üè∑Ô∏è <strong>PLANTILLAS_TAGS</strong>: Plantillas con marcadores SAP</div>
            <div class="list-item">‚úÖ <strong>PLIEGOS_TERMINADOS_ENTRENAMIENTO</strong>: Pliegos perfectos para IA</div>
            <div class="list-item">üîç <strong>DOCUMENTOS_VALIDACION</strong>: Pliegos para validar y corregir</div>
        </section>

        <section id="backup-restore">
            <h2>üíæ Sistema de Backup y Restauraci√≥n</h2>
            
            <h3>Descripci√≥n General</h3>
            <p>El sistema de backup proporciona una soluci√≥n completa para proteger y restaurar la base de datos SQLite que almacena los vectores y metadatos del sistema RAG. Incluye compresi√≥n autom√°tica, gesti√≥n de backups antiguos y programaci√≥n de backups peri√≥dicos.</p>
            
            <h3>Caracter√≠sticas del Sistema</h3>
            <div class="list-item">üíæ <strong>Backups Comprimidos</strong>: Compresi√≥n GZIP nivel 9 para ahorrar espacio</div>
            <div class="list-item">üîÑ <strong>Restauraci√≥n Segura</strong>: Crea backup de seguridad antes de restaurar</div>
            <div class="list-item">üóëÔ∏è <strong>Limpieza Autom√°tica</strong>: Mantiene solo los 10 backups m√°s recientes</div>
            <div class="list-item">‚è∞ <strong>Backups Programados</strong>: Ejecuci√≥n autom√°tica cada 24 horas</div>
            <div class="list-item">üìä <strong>Estad√≠sticas Detalladas</strong>: Informaci√≥n sobre espacio usado y backups disponibles</div>
            <div class="list-item">üõ°Ô∏è <strong>Validaci√≥n Autom√°tica</strong>: Verifica integridad antes de operaciones</div>
            
            <h3>Arquitectura del Sistema</h3>
            <table>
                <thead>
                    <tr>
                        <th>Componente</th>
                        <th>Ubicaci√≥n</th>
                        <th>Prop√≥sito</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>BackupService</strong></td>
                        <td>services/backupService.js</td>
                        <td>L√≥gica principal de backup/restore</td>
                    </tr>
                    <tr>
                        <td><strong>Base de Datos</strong></td>
                        <td>./data/rag_vectors.db</td>
                        <td>BD SQLite con vectores y metadatos</td>
                    </tr>
                    <tr>
                        <td><strong>Directorio Backups</strong></td>
                        <td>./data/backup/</td>
                        <td>Almacenamiento de archivos de backup</td>
                    </tr>
                    <tr>
                        <td><strong>Endpoints API</strong></td>
                        <td>routes/rag.js</td>
                        <td>Rutas REST para gesti√≥n de backups</td>
                    </tr>
                </tbody>
            </table>
            
            <h3>Funciones Principales</h3>
            
            <h4>1. Crear Backup</h4>
            <div class="code-block">
// Crear backup comprimido (recomendado)
const backup = await backupService.createBackup(true);

// Crear backup sin comprimir
const backup = await backupService.createBackup(false);

// Respuesta:
{
  success: true,
  filename: "backup_2024-10-08T12-30-00-000Z.db.gz",
  path: "./data/backup/backup_2024-10-08T12-30-00-000Z.db.gz",
  size: 524288,           // Tama√±o comprimido
  originalSize: 2097152,  // Tama√±o original
  compressed: true,
  timestamp: "2024-10-08T12:30:00.000Z"
}
            </div>
            
            <h4>2. Listar Backups</h4>
            <div class="code-block">
const backups = await backupService.listBackups();

// Respuesta (array ordenado por fecha):
[
  {
    filename: "backup_2024-10-08T12-30-00-000Z.db.gz",
    path: "./data/backup/backup_2024-10-08T12-30-00-000Z.db.gz",
    size: 524288,
    sizeFormatted: "512 KB",
    compressed: true,
    created: "2024-10-08T12:30:00.000Z",
    modified: "2024-10-08T12:30:00.000Z"
  }
]
            </div>
            
            <h4>3. Restaurar Backup</h4>
            <div class="code-block">
// Restaurar desde un backup espec√≠fico
const result = await backupService.restoreBackup('backup_2024-10-08T12-30-00-000Z.db.gz');

// El sistema autom√°ticamente:
// 1. Crea backup de seguridad de la BD actual
// 2. Descomprime el backup (si est√° comprimido)
// 3. Restaura la base de datos
// 4. Valida la operaci√≥n

// Respuesta:
{
  success: true,
  filename: "backup_2024-10-08T12-30-00-000Z.db.gz",
  message: "Base de datos restaurada correctamente",
  timestamp: "2024-10-08T12:35:00.000Z"
}
            </div>
            
            <h4>4. Eliminar Backup</h4>
            <div class="code-block">
const result = await backupService.deleteBackup('backup_2024-10-07T10-00-00-000Z.db.gz');

// Respuesta:
{
  success: true,
  filename: "backup_2024-10-07T10-00-00-000Z.db.gz",
  message: "Backup eliminado correctamente"
}
            </div>
            
            <h4>5. Obtener Estad√≠sticas</h4>
            <div class="code-block">
const stats = await backupService.getBackupStats();

// Respuesta:
{
  totalBackups: 10,
  compressedBackups: 8,
  uncompressedBackups: 2,
  totalSize: 5242880,
  totalSizeFormatted: "5 MB",
  maxBackups: 10,
  oldestBackup: "2024-10-01T08:00:00.000Z",
  newestBackup: "2024-10-08T12:30:00.000Z"
}
            </div>
            
            <h4>6. Programar Backups Autom√°ticos</h4>
            <div class="code-block">
// En server.js o al inicializar la aplicaci√≥n
import { backupService } from './services/backupService.js';

// Programar backups cada 24 horas (por defecto)
backupService.scheduleAutoBackup(24);

// O cada 12 horas
backupService.scheduleAutoBackup(12);

// El sistema ejecutar√°:
// - Backup inicial inmediato
// - Backups peri√≥dicos seg√∫n el intervalo
// - Limpieza autom√°tica de backups antiguos
            </div>
            
            <h3>Endpoints API REST</h3>
            
            <div class="endpoint">
                <span class="method post">POST</span> /api/rag/backup/create
            </div>
            <p>Crea un nuevo backup de la base de datos</p>
            <div class="code-block">
// Request
{
  "compress": true  // opcional, default: true
}

// Response
{
  "success": true,
  "backup": {
    "filename": "backup_2024-10-08T12-30-00-000Z.db.gz",
    "size": 524288,
    "compressed": true,
    "timestamp": "2024-10-08T12:30:00.000Z"
  }
}
            </div>
            
            <div class="endpoint">
                <span class="method get">GET</span> /api/rag/backup/list
            </div>
            <p>Lista todos los backups disponibles</p>
            <div class="code-block">
// Response
{
  "success": true,
  "backups": [
    {
      "filename": "backup_2024-10-08T12-30-00-000Z.db.gz",
      "size": 524288,
      "sizeFormatted": "512 KB",
      "compressed": true,
      "created": "2024-10-08T12:30:00.000Z"
    }
  ]
}
            </div>
            
            <div class="endpoint">
                <span class="method post">POST</span> /api/rag/backup/restore
            </div>
            <p>Restaura la base de datos desde un backup</p>
            <div class="code-block">
// Request
{
  "filename": "backup_2024-10-08T12-30-00-000Z.db.gz"
}

// Response
{
  "success": true,
  "message": "Base de datos restaurada correctamente",
  "timestamp": "2024-10-08T12:35:00.000Z"
}
            </div>
            
            <div class="endpoint">
                <span class="method delete">DELETE</span> /api/rag/backup/delete/:filename
            </div>
            <p>Elimina un backup espec√≠fico</p>
            <div class="code-block">
// Response
{
  "success": true,
  "message": "Backup eliminado correctamente"
}
            </div>
            
            <div class="endpoint">
                <span class="method get">GET</span> /api/rag/backup/stats
            </div>
            <p>Obtiene estad√≠sticas del sistema de backups</p>
            <div class="code-block">
// Response
{
  "success": true,
  "stats": {
    "totalBackups": 10,
    "compressedBackups": 8,
    "totalSize": 5242880,
    "totalSizeFormatted": "5 MB",
    "maxBackups": 10
  }
}
            </div>
            
            <div class="endpoint">
                <span class="method get">GET</span> /api/rag/backup/download/:filename
            </div>
            <p>Descarga un archivo de backup espec√≠fico</p>
            <div class="code-block">
// Descarga el archivo directamente
// Content-Type: application/gzip (si est√° comprimido)
// Content-Type: application/x-sqlite3 (si no est√° comprimido)
            </div>
            
            <h3>Compresi√≥n y Eficiencia</h3>
            <table>
                <thead>
                    <tr>
                        <th>Tama√±o Original</th>
                        <th>Tama√±o Comprimido</th>
                        <th>Ratio Compresi√≥n</th>
                        <th>Ahorro</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>10 MB</td>
                        <td>2.5 MB</td>
                        <td>75%</td>
                        <td>7.5 MB</td>
                    </tr>
                    <tr>
                        <td>50 MB</td>
                        <td>12 MB</td>
                        <td>76%</td>
                        <td>38 MB</td>
                    </tr>
                    <tr>
                        <td>100 MB</td>
                        <td>23 MB</td>
                        <td>77%</td>
                        <td>77 MB</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="success">
                <strong>üí° Recomendaci√≥n:</strong> Siempre usar compresi√≥n (compress: true) para ahorrar espacio. La compresi√≥n GZIP nivel 9 proporciona excelentes ratios sin impacto significativo en rendimiento.
            </div>
            
            <h3>Mejores Pr√°cticas</h3>
            
            <h4>1. Frecuencia de Backups</h4>
            <div class="list-item">‚è∞ <strong>Producci√≥n</strong>: Backups cada 24 horas (autom√°ticos)</div>
            <div class="list-item">üîÑ <strong>Desarrollo</strong>: Backups manuales antes de cambios importantes</div>
            <div class="list-item">üìä <strong>Alta Actividad</strong>: Backups cada 12 horas si hay muchas actualizaciones</div>
            
            <h4>2. Gesti√≥n de Almacenamiento</h4>
            <div class="list-item">üóëÔ∏è <strong>Limpieza Autom√°tica</strong>: El sistema mantiene solo 10 backups (configurable)</div>
            <div class="list-item">üíæ <strong>Backups Cr√≠ticos</strong>: Descargar y almacenar externamente backups importantes</div>
            <div class="list-item">üì¶ <strong>Compresi√≥n</strong>: Siempre usar compresi√≥n para optimizar espacio</div>
            
            <h4>3. Proceso de Restauraci√≥n</h4>
            <div class="warning">
                <strong>‚ö†Ô∏è IMPORTANTE:</strong> El sistema crea autom√°ticamente un backup de seguridad antes de cada restauraci√≥n. Esto previene p√©rdida de datos en caso de error.
            </div>
            
            <div class="code-block">
// Proceso recomendado para restaurar:
// 1. Verificar backups disponibles
GET /api/rag/backup/list

// 2. Descargar backup actual (opcional, por seguridad)
GET /api/rag/backup/download/backup_actual.db.gz

// 3. Restaurar desde backup deseado
POST /api/rag/backup/restore
{
  "filename": "backup_2024-10-08T12-30-00-000Z.db.gz"
}

// 4. Verificar que el sistema funciona correctamente
GET /api/rag/health
GET /api/rag/documents
            </div>
            
            <h4>4. Monitoreo y Alertas</h4>
            <div class="code-block">
// Script de monitoreo de backups (ejemplo)
const stats = await backupService.getBackupStats();

if (stats.totalBackups === 0) {
  console.error('‚ö†Ô∏è ALERTA: No hay backups disponibles');
}

if (stats.totalSize > 100 * 1024 * 1024) { // 100 MB
  console.warn('‚ö†Ô∏è ADVERTENCIA: Backups ocupan m√°s de 100 MB');
}

const lastBackupAge = Date.now() - new Date(stats.newestBackup);
if (lastBackupAge > 48 * 60 * 60 * 1000) { // 48 horas
  console.warn('‚ö†Ô∏è ADVERTENCIA: √öltimo backup tiene m√°s de 48 horas');
}
            </div>
            
            <h3>Configuraci√≥n Avanzada</h3>
            
            <h4>Personalizar L√≠mite de Backups</h4>
            <div class="code-block">
// En backupService.js
class BackupService {
  constructor() {
    this.maxBackups = 10; // Cambiar este valor
  }
}

// O configurar din√°micamente
backupService.maxBackups = 20; // Mantener 20 backups
            </div>
            
            <h4>Cambiar Ubicaci√≥n de Backups</h4>
            <div class="code-block">
// En backupService.js
class BackupService {
  constructor() {
    this.backupDir = './data/backup'; // Cambiar ruta
  }
}
            </div>
            
            <h4>Integraci√≥n con Cloud Storage</h4>
            <div class="code-block">
// Ejemplo: Subir backup a AWS S3 despu√©s de crearlo
import AWS from 'aws-sdk';
const s3 = new AWS.S3();

const backup = await backupService.createBackup(true);

// Leer archivo de backup
const fileContent = await fs.readFile(backup.path);

// Subir a S3
await s3.putObject({
  Bucket: 'my-backups',
  Key: `rag-backups/${backup.filename}`,
  Body: fileContent
}).promise();

console.log('‚úÖ Backup subido a S3');
            </div>
            
            <h3>Troubleshooting de Backups</h3>
            
            <div class="warning">
                <strong>‚ùå Error: "Base de datos no encontrada"</strong>
                <br><strong>Causa:</strong> El archivo rag_vectors.db no existe
                <br><strong>Soluci√≥n:</strong>
                <ul>
                    <li>Verificar que el sistema RAG se haya inicializado correctamente</li>
                    <li>Comprobar ruta: ./data/rag_vectors.db</li>
                    <li>Revisar permisos de escritura en directorio ./data/</li>
                </ul>
            </div>
            
            <div class="warning">
                <strong>‚ùå Error: "No se puede crear directorio de backups"</strong>
                <br><strong>Causa:</strong> Permisos insuficientes
                <br><strong>Soluci√≥n:</strong>
                <ul>
                    <li>Verificar permisos del directorio ./data/</li>
                    <li>Crear manualmente: mkdir -p ./data/backup</li>
                    <li>En Cloud Foundry: verificar que el directorio sea escribible</li>
                </ul>
            </div>
            
            <div class="warning">
                <strong>‚ùå Error: "Backup corrupto al restaurar"</strong>
                <br><strong>Causa:</strong> Archivo de backup da√±ado
                <br><strong>Soluci√≥n:</strong>
                <ul>
                    <li>Intentar con otro backup m√°s antiguo</li>
                    <li>Verificar integridad del archivo con: gzip -t backup.db.gz</li>
                    <li>El sistema habr√° creado un backup de seguridad antes de fallar</li>
                </ul>
            </div>
            
            <h3>Logs del Sistema de Backup</h3>
            <div class="code-block">
[BACKUP] ‚úÖ Directorio de backups inicializado
[BACKUP] üì¶ Compresi√≥n: 75.50% (2097152 ‚Üí 524288 bytes)
[BACKUP] ‚úÖ Backup creado: backup_2024-10-08T12-30-00-000Z.db.gz (0.50 MB)
[BACKUP] üóëÔ∏è Backup antiguo eliminado: backup_2024-09-30T08-00-00-000Z.db.gz
[BACKUP] üßπ 2 backups antiguos eliminados
[BACKUP] ‚è∞ Backups autom√°ticos programados cada 24 horas
[BACKUP] üì¶ Creando backup de seguridad antes de restaurar...
[BACKUP] ‚úÖ Base de datos restaurada desde: backup_2024-10-08T12-30-00-000Z.db.gz
            </div>
        </section>

        <section id="logs">
            <h2>üìä Sistema de Logs</h2>
            
            <h3>¬øPor qu√© un Sistema de Logs Propio?</h3>
            <div class="alert alert-info">
                <strong>‚ö†Ô∏è Problema con Cloud Foundry Logs:</strong>
                <p>Los logs de Cloud Foundry (<code>cf logs</code>) son extremadamente dif√≠ciles de leer y analizar:</p>
                <ul>
                    <li>‚ùå Formato poco legible con timestamps complejos</li>
                    <li>‚ùå Mezcla de logs de sistema y aplicaci√≥n</li>
                    <li>‚ùå Dif√≠cil b√∫squeda y filtrado</li>
                    <li>‚ùå No se pueden descargar f√°cilmente</li>
                    <li>‚ùå Se pierden cuando se reinicia la app</li>
                </ul>
                <p><strong>‚úÖ Soluci√≥n:</strong> Sistema de logging propio que escribe en archivo y permite descarga en formato Markdown limpio y organizado.</p>
            </div>
            
            <h3>Caracter√≠sticas del Sistema</h3>
            <div class="list-item">‚úÖ <strong>Doble escritura</strong>: Logs en consola (Cloud Foundry) y archivo local</div>
            <div class="list-item">‚úÖ <strong>Rotaci√≥n autom√°tica</strong>: Cuando el archivo supera 5MB</div>
            <div class="list-item">‚úÖ <strong>Formato Markdown</strong>: Descarga organizada y legible</div>
            <div class="list-item">‚úÖ <strong>Timestamps precisos</strong>: ISO 8601 en cada entrada</div>
            <div class="list-item">‚úÖ <strong>Niveles de log</strong>: INFO, ERROR, WARN, DEBUG, SUCCESS</div>
            <div class="list-item">‚úÖ <strong>Datos estructurados</strong>: JSON embebido para debugging</div>
            <div class="list-item">‚úÖ <strong>Estad√≠sticas</strong>: Tama√±o, l√≠neas, √∫ltima modificaci√≥n</div>
            
            <h3>Endpoints Disponibles</h3>
            
            <h4>1. Ver Logs (JSON)</h4>
            <div class="code-block">
GET /api/logs

# Respuesta
{
  "success": true,
  "logs": "[2025-11-18T07:00:00.000Z] [INFO] [RAG-SERVICE] Documento procesado..."
}
            </div>
            
            <h4>2. Descargar Logs (Markdown)</h4>
            <div class="code-block">
GET /api/logs/download

# Descarga archivo: aicore_api_logs_1731916800000.md
# Formato Markdown limpio y organizado
            </div>
            
            <h4>3. Estad√≠sticas de Logs</h4>
            <div class="code-block">
GET /api/logs/stats

# Respuesta
{
  "success": true,
  "stats": {
    "size": 524288,
    "sizeFormatted": "512.00 KB",
    "lines": 1250,
    "lastModified": "2025-11-18T07:30:00.000Z",
    "path": "/home/vcap/app/logs/app.log"
  }
}
            </div>
            
            <h4>4. Limpiar Logs</h4>
            <div class="code-block">
DELETE /api/logs

# Respuesta
{
  "success": true,
  "message": "Logs limpiados correctamente"
}
            </div>
            
            <h3>Uso en C√≥digo</h3>
            <div class="code-block">
import logger from './services/loggerService.js';

// Diferentes niveles de log
logger.info('MODULE-NAME', 'Operaci√≥n iniciada');
logger.success('MODULE-NAME', 'Operaci√≥n completada');
logger.warn('MODULE-NAME', 'Advertencia detectada');
logger.error('MODULE-NAME', 'Error cr√≠tico', { error: error.message });
logger.debug('MODULE-NAME', 'Info de debug', { data: someData });

// Ejemplo real
logger.info('RAG-SERVICE', 'Procesando documento', {
  filename: 'pliego.pdf',
  size: 1024000,
  contextId: 'abc-123'
});
            </div>
            
            <h3>Formato de Salida (Markdown)</h3>
            <div class="code-block">
# üìã Logs de AI Core API

**Generado:** 2025-11-18T07:30:00.000Z

---

```log
[2025-11-18T07:00:00.000Z] [INFO] [RAG-SERVICE] Documento procesado
{
  "filename": "pliego.pdf",
  "chunks": 45,
  "contextId": "abc-123"
}

[2025-11-18T07:01:00.000Z] [SUCCESS] [BACKUP] Backup creado correctamente

[2025-11-18T07:02:00.000Z] [ERROR] [PDF-SERVICE] Error procesando PDF
{
  "error": "Invalid PDF structure",
  "file": "documento.pdf"
}
```
            </div>
            
            <h3>Comandos √ötiles</h3>
            <div class="code-block">
# Descargar logs de producci√≥n
curl https://ai-core-api.cfapps.eu10-005.hana.ondemand.com/api/logs/download \
  -o aicore_logs_$(date +%Y%m%d).md

# Ver estad√≠sticas
curl https://ai-core-api.cfapps.eu10-005.hana.ondemand.com/api/logs/stats

# Limpiar logs (requiere autenticaci√≥n en producci√≥n)
curl -X DELETE https://ai-core-api.cfapps.eu10-005.hana.ondemand.com/api/logs

# Ver logs en tiempo real (Cloud Foundry - menos legible)
cf logs ai-core-api --recent
            </div>
            
            <h3>Rotaci√≥n de Logs</h3>
            <p>El sistema rota autom√°ticamente los logs cuando el archivo supera 5MB:</p>
            <div class="code-block">
# Archivo actual
logs/app.log (4.8 MB)

# Cuando supera 5MB, se renombra:
logs/app_2025-11-18T07-30-00-000Z.log (5.2 MB)

# Y se crea uno nuevo:
logs/app.log (0 KB)
            </div>
            
            <h3>Ventajas vs Cloud Foundry Logs</h3>
            <table>
                <thead>
                    <tr>
                        <th>Caracter√≠stica</th>
                        <th>Cloud Foundry Logs</th>
                        <th>Sistema Propio</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Formato</td>
                        <td>‚ùå Complejo y dif√≠cil de leer</td>
                        <td>‚úÖ Markdown limpio</td>
                    </tr>
                    <tr>
                        <td>Descarga</td>
                        <td>‚ùå No disponible</td>
                        <td>‚úÖ Endpoint directo</td>
                    </tr>
                    <tr>
                        <td>B√∫squeda</td>
                        <td>‚ùå Limitada</td>
                        <td>‚úÖ Archivo de texto plano</td>
                    </tr>
                    <tr>
                        <td>Persistencia</td>
                        <td>‚ùå Se pierden al reiniciar</td>
                        <td>‚úÖ Guardados en archivo</td>
                    </tr>
                    <tr>
                        <td>Estructura</td>
                        <td>‚ùå Mezclado con logs de sistema</td>
                        <td>‚úÖ Solo logs de aplicaci√≥n</td>
                    </tr>
                    <tr>
                        <td>Timestamps</td>
                        <td>‚ùå Formato complejo</td>
                        <td>‚úÖ ISO 8601 est√°ndar</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section id="guias">
            <h2>üìñ Gu√≠as de Uso</h2>
            
            <h3>Subida y Procesamiento de Documentos</h3>
            <div class="code-block">
# Via API REST
curl -X POST http://localhost:4000/api/rag/upload \
  -F "document=@documento.pdf" \
  -F "tags=politicas,empresa" \
  -F "description=Pol√≠ticas corporativas"

# Via interfaz web (si existe)
# Abrir http://localhost:4000/public/upload.html
            </div>
            
            <h3>B√∫squeda Sem√°ntica</h3>
            <div class="code-block">
# B√∫squeda general
curl -X POST http://localhost:4000/api/rag/search \
  -H "Content-Type: application/json" \
  -d '{
    "query": "trabajo remoto desde casa",
    "topK": 3,
    "minSimilarity": 0.4
  }'

# B√∫squeda en documento espec√≠fico
curl -X POST http://localhost:4000/api/rag/search \
  -H "Content-Type: application/json" \
  -d '{
    "query": "beneficios empleados",
    "topK": 5,
    "documentId": "doc_123"
  }'
            </div>
            
            <h3>Chat Conversacional RAG</h3>
            <div class="code-block">
# Pregunta simple
curl -X POST http://localhost:4000/api/rag/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "¬øCu√°les son las pol√≠ticas de vacaciones?"
  }'

# Pregunta compleja
curl -X POST http://localhost:4000/api/rag/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "Compara las pol√≠ticas de trabajo remoto con las de vacaciones",
    "maxTokens": 700,
    "temperature": 0.6
  }'
            </div>
            
            <h3>Correcci√≥n de PDFs</h3>
            <h4>Generar Lista de Correcciones:</h4>
            <div class="code-block">
curl -X POST http://localhost:4000/api/pdf-correction/generate-list \
  -F "pdf=@documento.pdf"
# Resultado: PDF con lista de correcciones al final
            </div>
            
            <h4>Aplicar Correcciones Directas:</h4>
            <div class="code-block">
curl -X POST http://localhost:4000/api/pdf-correction/apply-corrections \
  -F "pdf=@documento.pdf" \
  -F "corrections=‚Ä¢ tanbien -> tambi√©n
‚Ä¢ recivir -> recibir
‚Ä¢ Dokumento -> Documento"
# Resultado: PDF corregido con formato preservado
            </div>
            
            <h3>Validaci√≥n de Pliegos</h3>
            <div class="code-block">
# Validar pliego completo
curl -X POST http://localhost:4000/api/pliego-validation/validate \
  -F "file=@pliego.pdf"

# Validar con contexto RAG adicional
curl -X POST http://localhost:4000/api/pliego-validation/validate \
  -F "file=@pliego.pdf" \
  -F "contextId=DOCUMENTOS_VALIDACION"

# Validar texto directo
curl -X POST http://localhost:4000/api/pliego-validation/validate-text \
  -H "Content-Type: application/json" \
  -d '{
    "text": "Contenido del pliego...",
    "filename": "CT1078146_plec_edificacio_obert_amb_lots.pdf"
  }'
            </div>
            
            <h3>Gesti√≥n de Contextos</h3>
            <div class="code-block">
# Listar contextos
curl http://localhost:4000/api/rag/contexts

# Crear contexto
curl -X POST http://localhost:4000/api/rag/contexts \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Documentos Legales",
    "description": "Contratos y documentos legales"
  }'

# Eliminar contexto
curl -X DELETE http://localhost:4000/api/rag/contexts/{contextId}
            </div>
            
            <h3>Backup y Restauraci√≥n</h3>
            <div class="code-block">
# Descargar backup
curl -o backup.db http://localhost:4000/api/rag/download-db

# Informaci√≥n de base de datos
curl http://localhost:4000/api/rag/db-info

# Subir/restaurar backup
curl -X POST http://localhost:4000/api/rag/upload-db \
  -F "database=@backup.db"
            </div>
            
            <h3>Interfaz Web de Prueba</h3>
            <div class="list-item">üåê <strong>Correcci√≥n PDFs</strong>: http://localhost:4000/public/pdf-correction-test.html</div>
            <div class="list-item">üìä <strong>Dashboard Analytics</strong>: http://localhost:4000/analytics (si implementado)</div>
            <div class="list-item">‚öõÔ∏è <strong>Frontend React</strong>: http://localhost:3000 (proyecto separado)</div>
        </section>

        <section id="troubleshooting">
            <h2>üö® Troubleshooting</h2>
            
            <h3>Problemas Comunes</h3>
            
            <div class="warning">
                <strong>‚ùå Error: "ChromaDB no disponible"</strong>
                <br><strong>S√≠ntomas:</strong> Logs muestran fallback a memoria
                <br><strong>Soluci√≥n:</strong>
                <ul>
                    <li>Verificar configuraci√≥n VECTOR_STORE_TYPE</li>
                    <li>En local: iniciar chroma_service/start_service.bat</li>
                    <li>En CF: verificar que ChromaDB embebido se inicialice</li>
                </ul>
            </div>
            
            <div class="warning">
                <strong>‚ùå Error: "SAP AI Core no responde"</strong>
                <br><strong>S√≠ntomas:</strong> Timeouts en generaci√≥n de embeddings
                <br><strong>Soluci√≥n:</strong>
                <ul>
                    <li>Verificar credenciales en default-env.json</li>
                    <li>Comprobar servicios bindeados: cf services</li>
                    <li>Verificar conectividad de red</li>
                </ul>
            </div>
            
            <div class="warning">
                <strong>‚ùå Error: "Memory limit exceeded"</strong>
                <br><strong>S√≠ntomas:</strong> Aplicaci√≥n se reinicia frecuentemente
                <br><strong>Soluci√≥n:</strong>
                <pre>memory: 1G</pre>
                <p>O via CLI: cf scale ai_core_api -m 1G</p>
            </div>
            
            <div class="warning">
                <strong>‚ùå Error: "No documents found"</strong>
                <br><strong>S√≠ntomas:</strong> B√∫squedas no devuelven resultados
                <br><strong>Soluci√≥n:</strong>
                <ul>
                    <li>Verificar que documentos se cargaron: GET /api/rag/documents</li>
                    <li>Revisar logs de inicializaci√≥n</li>
                    <li>Re-ejecutar ingesta: node scripts/ingest-documents.js</li>
                </ul>
            </div>
            
            <h3>C√≥digos de Error</h3>
            <table>
                <thead>
                    <tr>
                        <th>C√≥digo</th>
                        <th>Descripci√≥n</th>
                        <th>Soluci√≥n</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="badge danger">500</span></td>
                        <td>Error interno del servidor</td>
                        <td>Revisar logs detallados</td>
                    </tr>
                    <tr>
                        <td><span class="badge danger">503</span></td>
                        <td>Servicio no disponible</td>
                        <td>Verificar dependencias</td>
                    </tr>
                    <tr>
                        <td><span class="badge warning">400</span></td>
                        <td>Request malformado</td>
                        <td>Validar formato JSON</td>
                    </tr>
                    <tr>
                        <td><span class="badge warning">404</span></td>
                        <td>Documento no encontrado</td>
                        <td>Verificar ID del documento</td>
                    </tr>
                    <tr>
                        <td><span class="badge warning">413</span></td>
                        <td>Archivo demasiado grande</td>
                        <td>Reducir tama√±o o aumentar l√≠mites</td>
                    </tr>
                </tbody>
            </table>
            
            <h3>Herramientas de Diagn√≥stico</h3>
            <div class="code-block">
# Script de diagn√≥stico
node tests/test_python_chroma.js > diagnostic.log 2>&1

# Verificaci√≥n de servicios
curl https://app-url/health
curl https://app-url/api/rag/health
curl https://app-url/api/rag/stats
            </div>
            
            <h3>Logs del Sistema</h3>
            <div class="list-item">üìù <strong>Cloud Foundry</strong>: cf logs ai_core_api</div>
            <div class="list-item">üíª <strong>Local</strong>: Consola del servidor</div>
            <div class="list-item">üè∑Ô∏è <strong>Tipos de Logs</strong>:
                <ul>
                    <li>[RAG] - Operaciones del sistema RAG</li>
                    <li>[CHROMA] - Operaciones ChromaDB</li>
                    <li>[EMBED] - Generaci√≥n de embeddings</li>
                    <li>[DOC] - Procesamiento de documentos</li>
                    <li>[API] - Requests HTTP</li>
                </ul>
            </div>
            
            <h3>Comandos de Monitoreo</h3>
            <div class="code-block">
# Cloud Foundry
cf app ai_core_api
cf logs ai_core_api --recent
cf events ai_core_api

# Health checks autom√°ticos
while true; do
  curl -f https://tu-app.cfapps.sap.hana.ondemand.com/health || echo "ALERT: App down"
  sleep 60
done
            </div>
        </section>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2025 - Sistema RAG con SAP AI Core y ChromaDB | Versi√≥n de Documentaci√≥n: 1.1.0 | √öltima Actualizaci√≥n: Noviembre 2025</p>
            <p><strong>Equipo de Desarrollo</strong> | <strong>Contacto:</strong> equipo@empresa.com | <strong>Repositorio:</strong> https://github.com/davidmelian-ees/aicore_api</p>
        </div>
    </footer>
</body>
</html>
